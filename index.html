<!doctype html>
<html lang="fa" dir="rtl" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ArminOS â€¢ Personal Planner</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#090d16">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <!-- Chart.js (CDN). Optional: you can bundle locally later. -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    /* =========================
       IRANSansX (local WOFF2)
       Put files in: ./fonts/
       ========================= */
    @font-face{
      font-family: "IRANSansX";
      src: url("./fonts/IRANSansX-Light.woff2") format("woff2");
      font-weight: 300;
      font-style: normal;
      font-display: swap;
    }
    @font-face{
      font-family: "IRANSansX";
      src: url("./fonts/IRANSansX-Medium.woff2") format("woff2");
      font-weight: 500;
      font-style: normal;
      font-display: swap;
    }
    @font-face{
      font-family: "IRANSansX";
      src: url("./fonts/IRANSansX-DemiBold.woff2") format("woff2");
      font-weight: 600;
      font-style: normal;
      font-display: swap;
    }
    @font-face{
      font-family: "IRANSansX";
      src: url("./fonts/IRANSansX-Bold.woff2") format("woff2");
      font-weight: 700;
      font-style: normal;
      font-display: swap;
    }
    @font-face{
      font-family: "IRANSansX";
      src: url("./fonts/IRANSansX-ExtraBold.woff2") format("woff2");
      font-weight: 800;
      font-style: normal;
      font-display: swap;
    }
@font-face{
  font-family: "IRANSansX";
  src: url("./fonts/IRANSansX-ExtraBold.woff2") format("woff2");
  font-weight: 900;
  font-style: normal;
  font-display: swap;
}

    /* =========================
       Design System (Tokens)
       ========================= */
    :root{
      --font-sans: "IRANSansX", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;

      --fs-1: 12px;
      --fs-2: 13px;
      --fs-3: 14px;
      --fs-4: 16px;
      --fs-5: 18px;

      --lh: 1.75;

      --s-1: 6px;
      --s-2: 10px;
      --s-3: 14px;
      --s-4: 18px;
      --s-5: 24px;

      --r-1: 14px;
      --r-2: 18px;
      --r-3: 24px;
      --r-4: 30px;

      --sidebar: 292px;
      --gap: var(--s-3);

      --shadow-1: 0 10px 30px rgba(0,0,0,.28);
      --shadow-2: 0 18px 60px rgba(0,0,0,.38);

      --ring: 0 0 0 4px rgba(154,230,255,.20);

      /* colors (dark) */
      --bg: #090d16;
      --bg2:#0b1122;
      --surface: rgba(255,255,255,.06);
      --surface2: rgba(255,255,255,.09);
      --border: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.66);
      --muted2: rgba(255,255,255,.46);

      --accent: #9ae6ff;
      --accent2:#b7ffcf;
      --danger:#ff7b7b;
      --warn:#ffd97b;
      --ok:#7bffb5;

      --grad:
        radial-gradient(950px 520px at 8% 10%, rgba(154,230,255,.18), transparent 60%),
        radial-gradient(980px 520px at 96% 26%, rgba(183,255,207,.14), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
    }
html, body {
  font-family: var(--font-sans);
}

button, input, textarea, select {
  font-family: inherit;
}

* {
  font-family: inherit;
}

    html[data-theme="light"]{
      --bg:#f5f7fc;
      --bg2:#eef2fb;
      --surface: rgba(0,0,0,.04);
      --surface2: rgba(0,0,0,.06);
      --border: rgba(0,0,0,.10);
      --text: rgba(0,0,0,.86);
      --muted: rgba(0,0,0,.58);
      --muted2: rgba(0,0,0,.42);
      --accent:#0ea5e9;
      --accent2:#22c55e;
      --ring: 0 0 0 4px rgba(14,165,233,.16);
      --shadow-1: 0 10px 26px rgba(0,0,0,.12);
      --shadow-2: 0 18px 54px rgba(0,0,0,.14);

      --grad:
        radial-gradient(950px 520px at 8% 10%, rgba(14,165,233,.12), transparent 60%),
        radial-gradient(980px 520px at 96% 26%, rgba(34,197,94,.12), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
    }

    *{ box-sizing:border-box; }
    html, body{
      height:100%;
      overflow-x: hidden;
    }
    body{
      margin:0;
      font-family: var(--font-sans);
      color: var(--text);
      background: var(--grad);
      line-height: var(--lh);
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    @media (prefers-reduced-motion: reduce){
      *{ animation: none !important; transition: none !important; scroll-behavior: auto !important; }
    }

    @keyframes viewIn{
      from{ opacity:0; transform: translateY(6px); }
      to{ opacity:1; transform: translateY(0); }
    }

    :where(button, input, select, textarea, a):focus-visible{
      outline: none;
      box-shadow: var(--ring);
      border-color: rgba(154,230,255,.30);
    }

    .app{
      display:grid;
      grid-template-columns: var(--sidebar) 1fr;
      gap: var(--gap);
      width: min(1360px, 100%);
      margin: 0 auto;
      padding: var(--s-4);
    }
    @media (max-width: 1120px){
      .app{ grid-template-columns: 1fr; }
    }

    .glass{
      border: 1px solid var(--border);
      background: color-mix(in srgb, var(--surface) 86%, transparent);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: var(--shadow-2);
    }

    /* Sidebar */
    .sidebar{
      position: sticky;
      top: var(--s-4);
      height: calc(100vh - (var(--s-4) * 2));
      border-radius: var(--r-4);
      overflow: hidden;
      display:flex;
      flex-direction:column;
      min-height: 0;
    }
    .side-top{
      padding: var(--s-4);
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, var(--surface2), transparent);
    }
    .brand{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: var(--s-2);
    }
    .brand h1{
      margin:0;
      font-size: var(--fs-5);
      letter-spacing: .2px;
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .badge{
      font-size: var(--fs-1);
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--surface2);
      color: var(--muted);
      user-select:none;
      white-space:nowrap;
    }

    .profile{
      margin-top: var(--s-3);
      display:flex;
      gap: var(--s-2);
      align-items:flex-start;
    }
    .avatar{
      width:46px;height:46px;border-radius: 16px;
      border: 1px solid var(--border);
      background: linear-gradient(135deg, rgba(154,230,255,.22), rgba(183,255,207,.10));
      display:flex;align-items:center;justify-content:center;
      font-weight:800;
      box-shadow: var(--shadow-1);
      flex: 0 0 auto;
    }
    .pname{ font-weight:800; font-size: var(--fs-4); }
    .ptitle{ font-size: var(--fs-1); color: var(--muted); margin-top: 2px; }

    .nav{
      padding: var(--s-3);
      display:grid;
      gap: 10px;
      flex: 1 1 auto;
      min-height: 0;
      overflow-y: auto;
    }
    .nav::-webkit-scrollbar{ width: 8px; }
    .nav::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.12);
      border-radius: 999px;
    }
    .nav::-webkit-scrollbar-track{ background: transparent; }
    .nav button{
      width:100%;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      color: var(--text);
      border-radius: var(--r-3);
      padding: 12px 12px;
      cursor:pointer;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      text-align:right;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: var(--s-2);
    }
    .nav button:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.06);
      border-color: color-mix(in srgb, var(--border) 60%, var(--accent) 40%);
    }
    .nav button.active{
      background: linear-gradient(135deg, rgba(154,230,255,.14), rgba(183,255,207,.10));
      border-color: rgba(154,230,255,.32);
    }
    .nav-left{
      display:flex;
      gap: 10px;
      align-items:center;
      min-width: 0;
    }
    .nav-ic{
      width: 38px;
      height: 38px;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: color-mix(in srgb, var(--surface2) 70%, transparent);
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: var(--shadow-1);
      flex: 0 0 auto;
      color: var(--text);
    }
    .nav button.active .nav-ic{
      border-color: rgba(154,230,255,.35);
      box-shadow: 0 10px 22px rgba(154,230,255,.10);
    }
    .nav-ic svg{ width: 18px; height: 18px; opacity: .95; }
    .nav-text{ min-width: 0; }
    .nav-title{ font-size: var(--fs-3); font-weight: 800; line-height: 1.25; }
    .nav-hint{ font-size: var(--fs-1); color: var(--muted2); margin-top: 2px; }
    .nav-arrow{
      color: var(--muted2);
      font-size: var(--fs-2);
      user-select:none;
    }

    .side-bottom{
      margin-top:auto;
      padding: var(--s-3) var(--s-3) var(--s-4);
      border-top: 1px solid var(--border);
      display:grid;
      gap: 10px;
      background: linear-gradient(0deg, var(--surface2), transparent);
    }

    .btn-row{ display:flex; gap: 10px; flex-wrap:wrap; }
    .btn{
      border: 1px solid var(--border);
      background: var(--surface2);
      color: var(--text);
      border-radius: var(--r-3);
      padding: 10px 12px;
      cursor:pointer;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      font-size: var(--fs-2);
      display:inline-flex;
      align-items:center;
      gap: 8px;
      user-select:none;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.10);
      border-color: color-mix(in srgb, var(--border) 60%, var(--accent) 40%);
    }
    .btn:active{ transform: translateY(0); }
    .btn.primary{
      background: linear-gradient(135deg, rgba(154,230,255,.20), rgba(183,255,207,.12));
      border-color: rgba(154,230,255,.35);
    }
    .btn.danger{
      border-color: rgba(255,123,123,.30);
      color: var(--danger);
      background: color-mix(in srgb, var(--surface2) 85%, rgba(255,123,123,.12) 15%);
    }
    .btn.ghost{ background: transparent; }

    /* Content */
    .content{
      border-radius: var(--r-4);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height: calc(100vh - (var(--s-4) * 2));
    }
    @media (max-width: 1120px){
      .content{ min-height:auto; }
    }

    .topbar{
      padding: var(--s-4);
      border-bottom: 1px solid var(--border);
      display:flex;
      gap: var(--s-2);
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      background: linear-gradient(180deg, var(--surface2), transparent);
    }
    .topbar-title{
      font-size: var(--fs-5);
      font-weight: 900;
      margin:0;
      letter-spacing: .2px;
    }
    .topbar-sub{
      font-size: var(--fs-1);
      color: var(--muted);
    }
    .topbar-actions{ display:flex; gap: 10px; flex-wrap:wrap; align-items:center; }

    .views{ padding: var(--s-4); }
    .view{ display:none; }
    .view.active{ display:block; animation: viewIn .22s ease both; }

    /* Cards & grid */
    .grid{ display:grid; gap: var(--gap); }
    .grid.cols-12{ grid-template-columns: repeat(12, 1fr); }
    .col-12{ grid-column: span 12; }
    .col-8{ grid-column: span 8; }
    .col-6{ grid-column: span 6; }
    .col-4{ grid-column: span 4; }
    @media (max-width: 1120px){
      .col-8,.col-6,.col-4{ grid-column: span 12; }
    }

    .card{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      border-radius: var(--r-3);
      padding: var(--s-4);
      box-shadow: var(--shadow-1);
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
    }
    .card:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.06);
      border-color: color-mix(in srgb, var(--border) 60%, var(--accent) 40%);
    }
    .card h3{
      margin: 0 0 8px 0;
      font-size: var(--fs-3);
      font-weight: 900;
    }
    .muted{ color: var(--muted); }
    .muted2{ color: var(--muted2); }
    .small{ font-size: var(--fs-1); }
    .kpi{
      font-size: 26px;
      font-weight: 900;
      margin-top: 6px;
      letter-spacing: .2px;
    }
    .row{
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .input, select, textarea{
      width:100%;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      border-radius: 16px;
      padding: 10px 12px;
      outline:none;
      font-family: inherit;
      font-size: var(--fs-2);
      transition: border-color .14s ease, background .14s ease, box-shadow .14s ease;
    }
    textarea{ min-height: 110px; resize: vertical; }
    label{ font-size: var(--fs-1); color: var(--muted); display:block; margin: 8px 0 6px; }

    .form-grid{
      display:grid;
      gap: 10px;
      grid-template-columns: repeat(2, 1fr);
    }
    .form-grid .full{ grid-column: span 2; }
    @media (max-width: 720px){
      .form-grid{ grid-template-columns: 1fr; }
      .form-grid .full{ grid-column: span 1; }
    }

    .chips{ display:flex; flex-wrap:wrap; gap: 8px; }
    .chip{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: var(--fs-1);
      color: var(--muted);
      display:inline-flex;
      align-items:center;
      gap: 6px;
      user-select:none;
    }
    .chip.ok{ border-color: rgba(123,255,181,.30); color: var(--ok); }
    .chip.warn{ border-color: rgba(255,217,123,.30); color: var(--warn); }
    .chip.danger{ border-color: rgba(255,123,123,.30); color: var(--danger); }
    .chip.acc{ border-color: rgba(154,230,255,.30); color: var(--accent); }

    /* Lists */
    .list{ display:grid; gap: 10px; }
    .item{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      border-radius: var(--r-3);
      padding: 12px;
      display:flex;
      gap: 12px;
      align-items:flex-start;
      justify-content:space-between;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
    }
    .item:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.06);
      border-color: color-mix(in srgb, var(--border) 60%, var(--accent) 40%);
    }
    .item-main{ flex:1; min-width: 230px; }
    .item-title{ font-weight: 900; margin:0 0 3px 0; font-size: var(--fs-3); }
    .item-meta{
      display:flex; flex-wrap:wrap; gap: 8px;
      font-size: var(--fs-1);
      color: var(--muted);
    }

    .icon-btn{
      width: 40px;
      height: 40px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      user-select:none;
    }
    .icon-btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.08);
      border-color: color-mix(in srgb, var(--border) 60%, var(--accent) 40%);
    }
    .icon-btn.danger{ border-color: rgba(255,123,123,.30); color: var(--danger); }

    /* Progress bar */
    .bar{
      width:100%;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      overflow:hidden;
      border: 1px solid var(--border);
    }
    .bar > i{
      display:block;
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(154,230,255,.85), rgba(183,255,207,.75));
      transition: width .22s ease;
    }

    /* Calendar */
    .cal-head{
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }
    #view-calendar .card{
      overflow: hidden;
    }
    .cal-grid{
      display:grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 10px;
    }
    .cal-dow{
      font-size: var(--fs-1);
      color: var(--muted);
      padding: 8px 10px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      text-align:center;
    }
    .cal-day{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      border-radius: var(--r-3);
      padding: 10px;
      min-height: 94px;
      cursor:pointer;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      display:flex;
      flex-direction:column;
      gap: 8px;
      min-width: 0;
    }
    .cal-day:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.06);
      border-color: color-mix(in srgb, var(--border) 60%, var(--accent) 40%);
    }
    .cal-day.blank{ opacity:.35; cursor:default; }
    .cal-top{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .cal-num{ font-weight: 900; }
    .cal-badges{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      min-width: 0;
    }

    .mini{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: rgba(255,255,255,.04);
      white-space:nowrap;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .mini.ok{ border-color: rgba(123,255,181,.28); color: var(--ok); }
    .mini.acc{ border-color: rgba(154,230,255,.28); color: var(--accent); }

    /* Tables */
    table{ width:100%; border-collapse:separate; border-spacing:0 10px; }
    th{
      text-align:right;
      font-size: var(--fs-1);
      color: var(--muted);
      font-weight: 800;
      padding: 0 10px;
    }
    td{
      padding: 12px 10px;
      background: rgba(255,255,255,.03);
      border-top: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      vertical-align: top;
    }
    td:first-child{ border-right: 1px solid var(--border); border-top-right-radius: 16px; border-bottom-right-radius: 16px; }
    td:last-child{ border-left: 1px solid var(--border); border-top-left-radius: 16px; border-bottom-left-radius: 16px; }
    .nowrap{ white-space:nowrap; }

    /* Dialog */
    dialog{
      border: 1px solid var(--border);
      border-radius: 26px;
      background: color-mix(in srgb, var(--surface2) 85%, transparent);
      color: var(--text);
      box-shadow: var(--shadow-2);
      width: min(760px, 92vw);
      padding: 0;
      overflow:hidden;
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }
    dialog::backdrop{
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
    }
    .dlg-head{
      padding: 14px 14px 12px;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent);
    }
    .dlg-title{ font-weight: 1000; margin:0; font-size: var(--fs-4); }
    .dlg-sub{ font-size: var(--fs-1); color: var(--muted); margin-top:4px; }
    .dlg-body{ padding: 14px; }
    .dlg-foot{
      padding: 12px 14px 14px;
      border-top: 1px solid var(--border);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      background: linear-gradient(0deg, rgba(255,255,255,.06), transparent);
    }

    /* Toast */
    .toast{
      position: fixed;
      left: 18px;
      bottom: 18px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.10);
      backdrop-filter: blur(12px);
      color: var(--text);
      border-radius: 18px;
      padding: 10px 12px;
      display:none;
      max-width: min(420px, 92vw);
      box-shadow: var(--shadow-2);
      font-size: var(--fs-2);
      animation: viewIn .18s ease both;
      z-index: 9998;
    }

    .sep{ height:1px; background: var(--border); margin: 10px 0; opacity:.9; }

    /* =========================
       Lock Screen (PIN)
       ========================= */
    .lock-screen{
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: none; /* shown via JS */
      align-items: center;
      justify-content: center;
      padding: var(--s-4);
      background:
        radial-gradient(800px 420px at 10% 10%, rgba(154,230,255,.22), transparent 60%),
        radial-gradient(900px 420px at 90% 70%, rgba(183,255,207,.18), transparent 55%),
        rgba(0,0,0,.60);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .lock-card{
      width: min(520px, 94vw);
      border-radius: var(--r-4);
      border: 1px solid var(--border);
      background: color-mix(in srgb, var(--surface2) 90%, transparent);
      box-shadow: var(--shadow-2);
      padding: var(--s-5);
      text-align: center;
    }
    .lock-title{
      font-size: 22px;
      font-weight: 900;
      letter-spacing: .2px;
    }
    .lock-sub{
      margin-top: 6px;
      font-size: var(--fs-2);
      color: var(--muted);
    }
    .pin-row{
      display:flex;
      gap: 10px;
      justify-content:center;
      margin-top: var(--s-4);
      direction: ltr;
    }
    .pin{
      width: 52px;
      height: 56px;
      text-align:center;
      font-size: 22px;
      font-weight: 900;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.05);
      color: var(--text);
      outline: none;
    }
    .lock-actions{
      margin-top: var(--s-4);
      display:flex;
      gap: 10px;
      justify-content:center;
      flex-wrap:wrap;
    }
    .lock-error{
      margin-top: 10px;
      font-size: var(--fs-2);
      color: var(--danger);
      min-height: 1.6em;
    }
    /* =========================
       Mobile overrides (layout + overflow)
       ========================= */
    @media (max-width: 1120px){
      .sidebar{
        position: static;
        height: auto;
        overflow: visible;
      }
      .nav{
        flex: 0 0 auto;
        min-height: auto;
        overflow: visible;
      }
      .side-bottom{
        margin-top: var(--s-3);
      }
    }

    @media (max-width: 560px){
      :root{
        --sidebar: 100%;
        --gap: 12px;
      }

      .app{
        width: 100%;
        padding: 12px;
        gap: 12px;
      }

      .topbar{
        padding: 12px;
        gap: 10px;
      }

      .views{
        padding: 12px;
      }

      .card{
        padding: 12px;
        border-radius: 20px;
      }

      .topbar-title{ font-size: 18px; }
      .topbar-sub{ font-size: 12px; }
      .kpi{ font-size: 22px; }

      .icon-btn{
        width: 36px;
        height: 36px;
        border-radius: 14px;
      }

      .cal-grid{
        gap: 8px;
        grid-template-columns: repeat(7, minmax(0, 1fr));
      }

      .cal-dow{
        padding: 6px 4px;
        font-size: 11px;
        border-radius: 12px;
      }

      .cal-day{
        min-height: 78px;
        padding: 8px;
        border-radius: 18px;
      }

      .cal-top{ gap: 6px; }
      .cal-num{ font-size: 13px; }
      .cal-badges{ gap: 6px; }

      .mini{
        font-size: 10px;
        padding: 3px 6px;
      }
    }

  </style>
</head>

<body>
  <!-- Lock Screen -->
  <div class="lock-screen" id="lockScreen" aria-hidden="true">
    <div class="lock-card">
      <div class="lock-title">ArminOS</div>
      <div class="lock-sub">Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ØŒ Ù¾ÛŒÙ† Û´ Ø±Ù‚Ù…ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†</div>

      <div class="pin-row" id="pinRow">
        <input class="pin" inputmode="numeric" pattern="[0-9]*" maxlength="1" data-idx="0" />
        <input class="pin" inputmode="numeric" pattern="[0-9]*" maxlength="1" data-idx="1" />
        <input class="pin" inputmode="numeric" pattern="[0-9]*" maxlength="1" data-idx="2" />
        <input class="pin" inputmode="numeric" pattern="[0-9]*" maxlength="1" data-idx="3" />
      </div>

      <div class="lock-actions">
        <button class="btn primary" id="btnUnlock">ÙˆØ±ÙˆØ¯</button>
        <button class="btn" id="btnClearPin">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
      </div>

      <div class="lock-error" id="lockError"></div>
      <div class="small muted2" style="margin-top:10px">
        Ù†Ú©ØªÙ‡: Ø§ÛŒÙ† Ù‚ÙÙ„ Â«Ú©Ù„Ø§ÛŒÙ†ØªÛŒÂ» Ø§Ø³Øª (Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø®ØµÛŒ Ø¹Ø§Ù„ÛŒÙ‡ØŒ Ø§Ù…Ø§ Ø§Ù…Ù†ÛŒØª Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ Ù†ÛŒØ³Øª).
      </div>
    </div>
  </div>

  <div class="app" id="appRoot">
    <!-- SIDEBAR -->
    <aside class="sidebar glass">
      <div class="side-top">
        <div class="brand">
          <h1>
            <span class="nav-ic" style="width:40px;height:40px">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 7.5c0-1.93 1.57-3.5 3.5-3.5h9C18.43 4 20 5.57 20 7.5v9c0 1.93-1.57 3.5-3.5 3.5h-9C5.57 20 4 18.43 4 16.5v-9Z"/>
                <path d="M8 9h8M8 12h8M8 15h5"/>
              </svg>
            </span>
            ArminOS
          </h1>
          <span class="badge">PWA â€¢ Jalali â€¢ PIN</span>
        </div>
        <div class="profile">
          <div class="avatar" id="avatar">A</div>
          <div>
            <div class="pname" id="pname">Ø¢Ø±Ù…ÛŒÙ†</div>
            <div class="ptitle" id="ptitle">ÙØ±ÛŒÙ„Ù†Ø³Ø± â€¢ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒ Ù…Ù‡Ù†Ø¯Ø³ÛŒ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±</div>
          </div>
        </div>
      </div>

      <nav class="nav" id="nav">
        <button data-view="dashboard" class="active">
          <div class="nav-left">
            <span class="nav-ic">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="8" height="8" rx="2"></rect>
                <rect x="13" y="3" width="8" height="8" rx="2"></rect>
                <rect x="3" y="13" width="8" height="8" rx="2"></rect>
                <rect x="13" y="13" width="8" height="8" rx="2"></rect>
              </svg>
            </span>
            <div class="nav-text">
              <div class="nav-title">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</div>
              <div class="nav-hint">Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ + Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§</div>
            </div>
          </div>
          <span class="nav-arrow">âŒ</span>
        </button>

        <button data-view="planner">
          <div class="nav-left">
            <span class="nav-ic">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <path d="M22 4 12 14.01l-3-3"></path>
              </svg>
            </span>
            <div class="nav-text">
              <div class="nav-title">Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡</div>
              <div class="nav-hint">ØªØ³Ú©â€ŒÙ‡Ø§ + ØªØ§ÛŒÙ…â€ŒØ¨Ù„Ø§Ú©</div>
            </div>
          </div>
          <span class="nav-arrow">âœ“</span>
        </button>

        <button data-view="calendar">
          <div class="nav-left">
            <span class="nav-ic">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                <path d="M16 2v4M8 2v4M3 10h18"></path>
              </svg>
            </span>
            <div class="nav-text">
              <div class="nav-title">ØªÙ‚ÙˆÛŒÙ… (Ø´Ù…Ø³ÛŒ)</div>
              <div class="nav-hint">Ù…Ø§Ù‡Ø§Ù†Ù‡ + Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø±ÙˆØ²</div>
            </div>
          </div>
          <span class="nav-arrow">ğŸ—“</span>
        </button>

        <button data-view="projects">
          <div class="nav-left">
            <span class="nav-ic">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                <path d="M16 20V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v16"></path>
                <rect x="8" y="2" width="8" height="4" rx="1"></rect>
                <path d="M4 20h16a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2h-4"></path>
              </svg>
            </span>
            <div class="nav-text">
              <div class="nav-title">Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§</div>
              <div class="nav-hint">Ø¯Ø±Ø¢Ù…Ø¯ + ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±ÙˆÚ˜Ù‡</div>
            </div>
          </div>
          <span class="nav-arrow">ğŸ’¼</span>
        </button>

        <button data-view="goals">
          <div class="nav-left">
            <span class="nav-ic">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="8"></circle>
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 2v2M12 20v2M2 12h2M20 12h2"></path>
              </svg>
            </span>
            <div class="nav-text">
              <div class="nav-title">Ø§Ù‡Ø¯Ø§Ù Ø¨Ø²Ø±Ú¯</div>
              <div class="nav-hint">Ù…Ø§ÛŒÙ„Ø³ØªÙˆÙ† + Ù¾ÛŒØ´Ø±ÙØª</div>
            </div>
          </div>
          <span class="nav-arrow">ğŸ¯</span>
        </button>

        <button data-view="finance">
          <div class="nav-left">
            <span class="nav-ic">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                <ellipse cx="12" cy="5" rx="8" ry="3"></ellipse>
                <path d="M4 5v6c0 1.66 3.58 3 8 3s8-1.34 8-3V5"></path>
                <path d="M4 11v6c0 1.66 3.58 3 8 3s8-1.34 8-3v-6"></path>
              </svg>
            </span>
            <div class="nav-text">
              <div class="nav-title">Ø³Ø±Ù…Ø§ÛŒÙ‡</div>
              <div class="nav-hint">Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ + Ù¾Ù„Ù† ØªÙ‚Ø³ÛŒÙ…</div>
            </div>
          </div>
          <span class="nav-arrow">ğŸª™</span>
        </button>

        <button data-view="notes">
          <div class="nav-left">
            <span class="nav-ic">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5V4.5A2.5 2.5 0 0 1 6.5 2Z"></path>
                <path d="M8 7h8M8 11h8M8 15h5"></path>
              </svg>
            </span>
            <div class="nav-text">
              <div class="nav-title">ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§</div>
              <div class="nav-hint">Ú˜ÙˆØ±Ù†Ø§Ù„ + Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ</div>
            </div>
          </div>
          <span class="nav-arrow">ğŸ“</span>
        </button>
      </nav>

      <div class="side-bottom">
        <div class="btn-row">
          <button class="btn primary" id="btnAddTask">ï¼‹ ØªØ³Ú©</button>
          <button class="btn" id="btnAddProject">ï¼‹ Ù¾Ø±ÙˆÚ˜Ù‡</button>
          <button class="btn" id="btnAddGoal">ï¼‹ Ù‡Ø¯Ù</button>
          <button class="btn" id="btnAddHolding">ï¼‹ Ø¯Ø§Ø±Ø§ÛŒÛŒ</button>
        </div>
        <div class="btn-row">
          <button class="btn" id="btnLock">ğŸ”’ Ù‚ÙÙ„</button>
          <button class="btn" id="btnTheme">ğŸŒ“ ØªÙ…</button>
          <button class="btn" id="btnExport">â¬‡ï¸ Ø®Ø±ÙˆØ¬ÛŒ</button>
          <button class="btn" id="btnImport">â¬†ï¸ ÙˆØ±ÙˆØ¯</button>
          <button class="btn danger" id="btnReset">Ø±ÛŒØ³Øª</button>
        </div>
        <div class="small muted2">
          Ø¨Ø±Ø§ÛŒ Ù†ØµØ¨ Ø±ÙˆÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„/Ø³ÛŒØ³ØªÙ…: Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ø§ÛŒØ¯ Ø±ÙˆÛŒ <b>https</b> ÛŒØ§ <b>localhost</b> Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯ (GitHub Pages Ø¹Ø§Ù„ÛŒÙ‡).
        </div>
      </div>
    </aside>

    <!-- CONTENT -->
    <section class="content glass">
      <header class="topbar">
        <div>
          <div class="topbar-title" id="viewTitle">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</div>
          <div class="topbar-sub" id="viewSub">Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ Ù¾ÛŒØ´Ø±ÙØªØŒ Ø¯Ø±Ø¢Ù…Ø¯ØŒ Ø³Ø±Ù…Ø§ÛŒÙ‡ Ùˆ Ø§Ù‡Ø¯Ø§Ù</div>
        </div>
        <div class="topbar-actions">
          <span class="badge" id="todayBadge">â€”</span>
          <span class="badge" id="monthBadge">â€”</span>
        </div>
      </header>

      <main class="views">
        <!-- DASHBOARD -->
        <section class="view active" id="view-dashboard">
          <div class="grid cols-12">
            <div class="card col-4">
              <div class="row">
                <h3>Ù¾ÛŒØ´Ø±ÙØª Ø§Ù…Ø±ÙˆØ²</h3>
                <span class="chip" id="dashTodayChip">â€”</span>
              </div>
              <div class="kpi" id="dashTodayKpi">â€”</div>
              <div class="muted small" id="dashTodayMeta">â€”</div>
              <div style="margin-top:10px" class="bar"><i id="dashTodayBar"></i></div>
            </div>

            <div class="card col-4">
              <div class="row">
                <h3>ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø§Ù‡ (Ø´Ù…Ø³ÛŒ)</h3>
                <span class="chip" id="dashMonthChip">â€”</span>
              </div>
              <div class="kpi" id="dashMonthKpi">â€”</div>
              <div class="muted small" id="dashMonthMeta">â€”</div>
              <div style="margin-top:10px" class="bar"><i id="dashMonthBar"></i></div>
            </div>

            <div class="card col-4">
              <div class="row">
                <h3>Ø¯Ø±Ø¢Ù…Ø¯ Ø§ÛŒÙ† Ù…Ø§Ù‡ (Ø´Ù…Ø³ÛŒ)</h3>
                <span class="chip acc">ğŸ’¼</span>
              </div>
              <div class="kpi" id="dashIncomeKpi">â€”</div>
              <div class="muted small" id="dashIncomeMeta">â€”</div>
              <div class="sep"></div>
              <div class="small muted">Ù‡Ø¯Ù Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø² Ù…Ø§Ù‡Ø§Ù†Ù‡:</div>
              <div class="row" style="margin-top:6px">
                <span class="chip ok" id="dashSaveTarget">â€”</span>
                <span class="muted2 small">Ù†Ø±Ø®: <span id="dashSaveRate">â€”</span></span>
              </div>
            </div>

            <div class="card col-8">
              <div class="row">
                <h3>Ù†Ù…ÙˆØ¯Ø§Ø± Û· Ø±ÙˆØ² Ø§Ø®ÛŒØ± (Ù†Ø±Ø® Ø§Ù†Ø¬Ø§Ù… ØªØ³Ú©)</h3>
                <span class="badge">Tasks %</span>
              </div>
              <div class="muted2 small">Ø§Ú¯Ø± Chart.js Ù„ÙˆØ¯ Ù†Ø´Ù‡ØŒ Ù†Ù…ÙˆØ¯Ø§Ø± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´Ù‡ ÙˆÙ„ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ú©Ø§Ù…Ù„ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡.</div>
              <div style="height: 280px; margin-top: 10px">
                <canvas id="chartWeek"></canvas>
                <div class="muted small" id="chartWeekFallback" style="display:none;margin-top:8px">Chart.js Ù„ÙˆØ¯ Ù†Ø´Ø¯.</div>
              </div>
            </div>

            <div class="card col-4">
              <h3>Ø¬Ù…Ù„Ù‡ Ø§Ù…Ø±ÙˆØ²</h3>
              <div class="muted2 small">Ø§Ø² Ø¨Ø®Ø´ Â«ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§Â» Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ± Ø§Ø³Øª.</div>
              <div class="sep"></div>
              <div id="dashMotivation" style="line-height:1.9"></div>
              <div class="sep"></div>
              <button class="btn" id="btnGoNotes">Ø±ÙØªÙ† Ø¨Ù‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§</button>
            </div>

            <div class="card col-6">
              <div class="row">
                <h3>Ø¯Ø±Ø¢Ù…Ø¯ Û¶ Ù…Ø§Ù‡ Ø§Ø®ÛŒØ± (Ø´Ù…Ø³ÛŒ)</h3>
                <span class="badge">Income</span>
              </div>
              <div style="height: 280px; margin-top: 10px">
                <canvas id="chartIncome"></canvas>
                <div class="muted small" id="chartIncomeFallback" style="display:none;margin-top:8px">Chart.js Ù„ÙˆØ¯ Ù†Ø´Ø¯.</div>
              </div>
            </div>

            <div class="card col-6">
              <div class="row">
                <h3>Ù¾Ø±ØªÙÙˆÛŒ Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§</h3>
                <span class="badge">Holdings</span>
              </div>
              <div class="muted2 small">Ø¨Ø±Ø§Ø³Ø§Ø³ Â«ÙˆØ§Ø­Ø¯ Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡Â» (ØªÙˆÙ…Ø§Ù†/USDT/USD...).</div>
              <div style="height: 280px; margin-top: 10px">
                <canvas id="chartPortfolio"></canvas>
                <div class="muted small" id="chartPortfolioFallback" style="display:none;margin-top:8px">Chart.js Ù„ÙˆØ¯ Ù†Ø´Ø¯.</div>
              </div>
            </div>
          </div>
        </section>

        <!-- PLANNER -->
        <section class="view" id="view-planner">
          <div class="grid cols-12">
            <div class="card col-12">
              <div class="row">
                <div>
                  <h3 style="margin-bottom:2px">Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡</h3>
                  <div class="muted small">ØªØ³Ú© Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ØŒ ØªÛŒÚ© Ø¨Ø²Ù†ØŒ Ùˆ Ú¯Ø²Ø§Ø±Ø´ Ø¨Ú¯ÛŒØ±.</div>
                </div>
                <div class="btn-row" style="align-items:center">
                  <input class="input" type="date" id="plannerDate" style="width: 180px" />
                  <span class="badge" id="plannerJalaliBadge">â€”</span>
                  <button class="btn primary" id="btnAddTask2">ï¼‹ Ø§ÙØ²ÙˆØ¯Ù† ØªØ³Ú©</button>
                </div>
              </div>

              <div class="sep"></div>

              <div class="form-grid">
                <div class="full">
                  <label>Ø§ÙØ²ÙˆØ¯Ù† Ø³Ø±ÛŒØ¹</label>
                  <div class="row" style="gap:10px; align-items:stretch">
                    <input class="input" id="quickTaskTitle" placeholder="Ù…Ø«Ù„Ø§Ù‹: Û´Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡ ØªÙ…Ø±ÛŒÙ† Ø·Ø±Ø§Ø­ÛŒ / Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ù…Ø´ØªØ±ÛŒ / Ù…Ø·Ø§Ù„Ø¹Ù‡..." />
                    <button class="btn primary nowrap" id="btnQuickAdd">Ø§ÙØ²ÙˆØ¯Ù†</button>
                  </div>
                  <div class="row" style="margin-top:10px">
                    <div class="chips">
                      <span class="chip">ØªØ¹Ø¯Ø§Ø¯: <b id="plannerCount">0</b></span>
                      <span class="chip ok">Ø§Ù†Ø¬Ø§Ù…â€ŒØ´Ø¯Ù‡: <b id="plannerDone">0</b></span>
                      <span class="chip acc">Ù¾ÛŒØ´Ø±ÙØª: <b id="plannerRate">0%</b></span>
                    </div>
                    <div style="width: min(420px, 100%); margin-top:8px">
                      <div class="bar"><i id="plannerBar"></i></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="card col-12">
              <div class="row">
                <h3>Ù„ÛŒØ³Øª ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ø±ÙˆØ²</h3>
                <div class="chips">
                  <span class="chip">ÙÛŒÙ„ØªØ±:</span>
                  <button class="btn ghost" id="toggleShowDone">Ù†Ù…Ø§ÛŒØ´ Ø§Ù†Ø¬Ø§Ù…â€ŒØ´Ø¯Ù‡â€ŒÙ‡Ø§: <b id="showDoneState">Ø±ÙˆØ´Ù†</b></button>
                </div>
              </div>
              <div class="sep"></div>
              <div class="list" id="plannerList"></div>
              <div class="muted small" id="plannerEmpty" style="display:none">
                Ù‡Ù†ÙˆØ² ØªØ³Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø±ÙˆØ² Ù†Ø¯Ø§Ø±ÛŒ. Ø§Ø² Ø¨Ø§Ù„Ø§ Â«Ø§ÙØ²ÙˆØ¯Ù†Â» Ú©Ù†.
              </div>
            </div>
          </div>
        </section>

        <!-- CALENDAR -->
        <section class="view" id="view-calendar">
          <div class="card">
            <div class="cal-head">
              <div>
                <h3 style="margin-bottom:2px">ØªÙ‚ÙˆÛŒÙ… Ù…Ø§Ù‡Ø§Ù†Ù‡ (Ø´Ù…Ø³ÛŒ)</h3>
                <div class="muted small">Ø±ÙˆÛŒ Ù‡Ø± Ø±ÙˆØ² Ú©Ù„ÛŒÚ© Ú©Ù† ØªØ§ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡Ù…ÙˆÙ† Ø±ÙˆØ² Ø¨Ø§Ø² Ø´Ù‡.</div>
              </div>
              <div class="btn-row">
                <button class="btn" id="btnPrevMonth">â—€ Ù…Ø§Ù‡ Ù‚Ø¨Ù„</button>
                <span class="badge" id="calMonthLabel">â€”</span>
                <button class="btn" id="btnNextMonth">Ù…Ø§Ù‡ Ø¨Ø¹Ø¯ â–¶</button>
              </div>
            </div>

            <div class="cal-grid" id="calDow"></div>
            <div style="height:10px"></div>
            <div class="cal-grid" id="calGrid"></div>
          </div>
        </section>

        <!-- PROJECTS -->
        <section class="view" id="view-projects">
          <div class="grid cols-12">
            <div class="card col-12">
              <div class="row">
                <div>
                  <h3 style="margin-bottom:2px">Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§</h3>
                  <div class="muted small">Ø«Ø¨Øª Ù¾Ø±ÙˆÚ˜Ù‡ØŒ Ù…Ø¨Ù„ØºØŒ ÙˆØ¶Ø¹ÛŒØª Ùˆ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§.</div>
                </div>
                <div class="btn-row">
                  <button class="btn primary" id="btnAddProject2">ï¼‹ Ø§ÙØ²ÙˆØ¯Ù† Ù¾Ø±ÙˆÚ˜Ù‡</button>
                  <select id="projectFilter" style="width: 180px">
                    <option value="all">Ù‡Ù…Ù‡ ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§</option>
                    <option value="todo">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</option>
                    <option value="doing">Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…</option>
                    <option value="done">Ø§Ù†Ø¬Ø§Ù…â€ŒØ´Ø¯Ù‡</option>
                  </select>
                </div>
              </div>
              <div class="sep"></div>
              <div class="chips">
                <span class="chip">Ø§ÛŒÙ† Ù…Ø§Ù‡ (Ø´Ù…Ø³ÛŒ): <b id="projMonthCount">0</b> Ù¾Ø±ÙˆÚ˜Ù‡</span>
                <span class="chip acc">Ø¯Ø±Ø¢Ù…Ø¯ Ø§ÛŒÙ† Ù…Ø§Ù‡: <b id="projMonthIncome">0</b></span>
              </div>
            </div>

            <div class="card col-12">
              <table>
                <thead>
                  <tr>
                    <th>Ø¹Ù†ÙˆØ§Ù†</th>
                    <th>Ù…Ø´ØªØ±ÛŒ</th>
                    <th>Ù…Ø¨Ù„Øº</th>
                    <th>ØªØ§Ø±ÛŒØ® (Ø´Ù…Ø³ÛŒ)</th>
                    <th>ÙˆØ¶Ø¹ÛŒØª</th>
                    <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                  </tr>
                </thead>
                <tbody id="projectTbody"></tbody>
              </table>
              <div class="muted small" id="projectsEmpty" style="display:none">Ù‡Ù†ÙˆØ² Ù¾Ø±ÙˆÚ˜Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡.</div>
            </div>
          </div>
        </section>

        <!-- GOALS -->
        <section class="view" id="view-goals">
          <div class="grid cols-12">
            <div class="card col-12">
              <div class="row">
                <div>
                  <h3 style="margin-bottom:2px">Ø§Ù‡Ø¯Ø§Ù Ø¨Ø²Ø±Ú¯</h3>
                  <div class="muted small">Ù‡Ø¯Ù + Ù…Ø§ÛŒÙ„Ø³ØªÙˆÙ† + Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª.</div>
                </div>
                <button class="btn primary" id="btnAddGoal2">ï¼‹ Ø§ÙØ²ÙˆØ¯Ù† Ù‡Ø¯Ù</button>
              </div>
            </div>

            <div class="col-12 list" id="goalsList"></div>
            <div class="muted small" id="goalsEmpty" style="display:none">Ù‡Ù†ÙˆØ² Ù‡Ø¯ÙÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡.</div>
          </div>
        </section>

        <!-- FINANCE -->
        <section class="view" id="view-finance">
          <div class="grid cols-12">
            <div class="card col-6">
              <div class="row">
                <div>
                  <h3 style="margin-bottom:2px">Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§</h3>
                  <div class="muted small">Ø·Ù„Ø§/Ù†Ù‚Ø±Ù‡/Ú©Ø±ÛŒÙ¾ØªÙˆ/Ù†Ù‚Ø¯â€¦ Ù‡Ø± Ú†ÛŒØ²ÛŒ Ø±Ùˆ Ø«Ø¨Øª Ú©Ù†.</div>
                </div>
                <button class="btn primary" id="btnAddHolding2">ï¼‹ Ø¯Ø§Ø±Ø§ÛŒÛŒ</button>
              </div>
              <div class="sep"></div>
              <div class="muted2 small">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: Ù‡Ø± Ù‡ÙØªÙ‡/Ù…Ø§Ù‡ Ø¢Ù¾Ø¯ÛŒØª Ú©Ù† ØªØ§ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ Ù…Ø¹Ù†ÛŒâ€ŒØ¯Ø§Ø± Ø¨Ø´Ù†.</div>
              <div style="height:10px"></div>
              <table>
                <thead>
                  <tr>
                    <th>Ù†ÙˆØ¹</th>
                    <th>Ù…Ù‚Ø¯Ø§Ø±</th>
                    <th>ÙˆØ§Ø­Ø¯</th>
                    <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                  </tr>
                </thead>
                <tbody id="holdingsTbody"></tbody>
              </table>
              <div class="muted small" id="holdingsEmpty" style="display:none">Ù‡Ù†ÙˆØ² Ø¯Ø§Ø±Ø§ÛŒÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡.</div>
            </div>

            <div class="card col-6">
              <h3 style="margin-bottom:2px">Ù¾Ù„Ù† Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ</h3>
              <div class="muted small">Ø¯Ø±ØµØ¯Ù‡Ø§ Ø±Ùˆ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ù†Ú¯Ù‡ Ø¯Ø§Ø±.</div>
              <div class="sep"></div>

              <label>Ø­Ø¯Ø§Ù‚Ù„ Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡</label>
              <input class="input" type="number" id="monthlyMinIncome" />

              <label>Ù†Ø±Ø® Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø² Ù‡Ø¯Ù (Ù…Ø«Ù„Ø§Ù‹ 0.3 ÛŒØ¹Ù†ÛŒ 30%)</label>
              <input class="input" type="number" step="0.01" id="savingsRateTarget" />

              <div class="sep"></div>
              <div class="row">
                <h3 style="margin:0">ØªÙ‚Ø³ÛŒÙ… Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ</h3>
                <button class="btn" id="btnNormalizeSplit">Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¨Ù‡ 100%</button>
              </div>

              <div class="form-grid" style="margin-top:10px">
                <div>
                  <label>Ø·Ù„Ø§ (%)</label>
                  <input class="input" type="number" id="splitGold" />
                </div>
                <div>
                  <label>Ú©Ø±ÛŒÙ¾ØªÙˆ (%)</label>
                  <input class="input" type="number" id="splitCrypto" />
                </div>
                <div>
                  <label>Ù†Ù‚Ø±Ù‡ (%)</label>
                  <input class="input" type="number" id="splitSilver" />
                </div>
                <div>
                  <label>Ù†Ù‚Ø¯/ØªØªØ± Ø¢Ø²Ø§Ø¯ (%)</label>
                  <input class="input" type="number" id="splitCash" />
                </div>
                <div class="full">
                  <div class="chips">
                    <span class="chip">Ø¬Ù…Ø¹: <b id="splitSum">100%</b></span>
                    <span class="chip warn" id="splitWarn" style="display:none">Ø¬Ù…Ø¹ Ø¯Ø±ØµØ¯Ù‡Ø§ Ø¨Ø§ÛŒØ¯ 100% Ø¨Ø§Ø´Ø¯.</span>
                  </div>
                </div>
              </div>

              <div class="sep"></div>
              <h3 style="margin-bottom:4px">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø®Ø±ÙˆØ¬ÛŒ Ù…Ø§Ù‡Ø§Ù†Ù‡</h3>
              <div class="muted small">Ø¨Ø±Ø§Ø³Ø§Ø³ Ø­Ø¯Ø§Ù‚Ù„ Ø¯Ø±Ø¢Ù…Ø¯ Ùˆ Ù†Ø±Ø® Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø².</div>
              <div class="sep"></div>
              <div class="chips" id="financeSuggestions"></div>
            </div>
          </div>
        </section>

        <!-- NOTES -->
        <section class="view" id="view-notes">
          <div class="grid cols-12">
            <div class="card col-12">
              <div class="row">
                <div>
                  <h3 style="margin-bottom:2px">ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ Ùˆ Ú˜ÙˆØ±Ù†Ø§Ù„</h3>
                  <div class="muted small">Ù‡Ø± Ú†ÛŒ Ù…Ù‡Ù…Ù‡ Ø«Ø¨Øª Ú©Ù† (Auto Save).</div>
                </div>
                <span class="badge">Auto Save</span>
              </div>
            </div>

            <div class="card col-6">
              <h3>Ø¨Ø±Ù†Ø§Ù…Ù‡/Ù†ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡</h3>
              <label>Ú†ÛŒ Ø§Ù…Ø±ÙˆØ² Ù…Ù‡Ù…Ù‡ØŸ</label>
              <textarea id="noteDaily" placeholder="Ø§Ù…Ø±ÙˆØ² Û² Ú©Ø§Ø± Ø§ØµÙ„ÛŒ..."></textarea>
            </div>

            <div class="card col-6">
              <h3>Ø¬Ù…Ù„Ù‡ Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ</h3>
              <label>Ø¬Ù…Ù„Ù‡ Ú©ÙˆØªØ§Ù‡ Ø±ÙˆØ²</label>
              <textarea id="noteMotivation" placeholder="ØªÙ…Ø±Ú©Ø² Ø±ÙˆÛŒ Ø³ÛŒØ³ØªÙ…ØŒ Ù†Ù‡ Ù‡ÛŒØ¬Ø§Ù†."></textarea>
            </div>

            <div class="card col-12">
              <h3>Ú˜ÙˆØ±Ù†Ø§Ù„</h3>
              <label>Ø«Ø¨Øª Ø§ØªÙØ§Ù‚Ø§ØªØŒ Ø¯Ø±Ø³â€ŒÙ‡Ø§ØŒ Ø§Ø­Ø³Ø§Ø³Ø§Øª</label>
              <textarea id="noteJournal" placeholder="Ø§Ù…Ø±ÙˆØ² Ú†ÛŒ ÛŒØ§Ø¯ Ú¯Ø±ÙØªÙ…ØŸ"></textarea>
            </div>

            <div class="card col-12">
              <h3>Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§</h3>
              <label>Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡/Ù…Ø­ØµÙˆÙ„/ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ</label>
              <textarea id="noteIdeas" placeholder="Ø§ÛŒØ¯Ù‡: ..."></textarea>
            </div>
          </div>
        </section>
      </main>
    </section>
  </div>

  <!-- DIALOGS -->
  <dialog id="dlgTask">
    <div class="dlg-head">
      <div>
        <div class="dlg-title" id="dlgTaskTitle">Ø§ÙØ²ÙˆØ¯Ù† ØªØ³Ú©</div>
        <div class="dlg-sub">ØªØ³Ú©ØŒ ØªØ§Ø±ÛŒØ®ØŒ Ø§ÙˆÙ„ÙˆÛŒØª Ùˆ ØªØ§ÛŒÙ…â€ŒØ¨Ù„Ø§Ú© Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†.</div>
      </div>
      <button class="icon-btn" data-close="dlgTask" title="Ø¨Ø³ØªÙ†">âœ•</button>
    </div>
    <div class="dlg-body">
      <div class="form-grid">
        <div class="full">
          <label>Ø¹Ù†ÙˆØ§Ù†</label>
          <input class="input" id="taskTitle" placeholder="Ù…Ø«Ù„Ø§Ù‹: Û´Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡ ØªÙ…Ø±ÛŒÙ† UI" />
        </div>

        <div>
          <label>ØªØ§Ø±ÛŒØ® (Ù…ÛŒÙ„Ø§Ø¯ÛŒ - Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡)</label>
          <input class="input" type="date" id="taskDate" />
          <div class="muted2 small" id="taskDateJ" style="margin-top:6px">â€”</div>
        </div>

        <div>
          <label>Ø§ÙˆÙ„ÙˆÛŒØª</label>
          <select class="input" id="taskPriority">
            <option value="low">Ú©Ù…</option>
            <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
            <option value="high">Ø²ÛŒØ§Ø¯</option>
          </select>
        </div>

        <div>
          <label>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
          <input class="input" id="taskCategory" placeholder="Ú©Ø§Ø± / Ø¯Ø±Ø³ / Ù…Ù‡Ø§Ø±Øª / Ø³Ù„Ø§Ù…ØªÛŒ ..." />
        </div>

        <div>
          <label>ØªØ§ÛŒÙ…â€ŒØ¨Ù„Ø§Ú©</label>
          <select class="input" id="taskTimeBlock">
            <option value="ØµØ¨Ø­">ØµØ¨Ø­</option>
            <option value="Ø¸Ù‡Ø±">Ø¸Ù‡Ø±</option>
            <option value="Ø¹ØµØ±">Ø¹ØµØ±</option>
            <option value="Ø´Ø¨">Ø´Ø¨</option>
          </select>
        </div>

        <div class="full">
          <label>ØªØ®Ù…ÛŒÙ† Ø²Ù…Ø§Ù† (Ø¯Ù‚ÛŒÙ‚Ù‡)</label>
          <input class="input" type="number" id="taskEstimate" min="0" step="5" value="30" />
        </div>

        <div class="full">
          <label>
            <input type="checkbox" id="taskDone" />
            Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡
          </label>
        </div>
      </div>
    </div>
    <div class="dlg-foot">
      <button class="btn danger" id="btnTaskDelete" style="visibility:hidden">Ø­Ø°Ù</button>
      <div class="btn-row">
        <button class="btn" data-close="dlgTask">Ø§Ù†ØµØ±Ø§Ù</button>
        <button class="btn primary" id="btnTaskSave">Ø°Ø®ÛŒØ±Ù‡</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgProject">
    <div class="dlg-head">
      <div>
        <div class="dlg-title" id="dlgProjectTitle">Ø§ÙØ²ÙˆØ¯Ù† Ù¾Ø±ÙˆÚ˜Ù‡</div>
        <div class="dlg-sub">Ø«Ø¨Øª Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ Ø¨Ø§Ø¹Ø« Ù…ÛŒØ´Ù‡ Ø¯Ø±Ø¢Ù…Ø¯ Ùˆ Ø±Ø´Ø¯ ÙˆØ§Ù‚Ø¹ÛŒâ€ŒØª Ù…Ø´Ø®Øµ Ø¨Ø´Ù‡.</div>
      </div>
      <button class="icon-btn" data-close="dlgProject" title="Ø¨Ø³ØªÙ†">âœ•</button>
    </div>
    <div class="dlg-body">
      <div class="form-grid">
        <div class="full">
          <label>Ø¹Ù†ÙˆØ§Ù† Ù¾Ø±ÙˆÚ˜Ù‡</label>
          <input class="input" id="projName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø·Ø±Ø§Ø­ÛŒ Ù„ÙˆÚ¯Ùˆ / UI Ø³Ø§ÛŒØª ..." />
        </div>
        <div>
          <label>Ù…Ø´ØªØ±ÛŒ</label>
          <input class="input" id="projClient" placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ/Ø¨Ø±Ù†Ø¯" />
        </div>
        <div>
          <label>Ù…Ø¨Ù„Øº</label>
          <input class="input" type="number" id="projAmount" placeholder="Ù…Ø«Ù„Ø§Ù‹ 6500000" />
        </div>
        <div>
          <label>ØªØ§Ø±ÛŒØ® (Ù…ÛŒÙ„Ø§Ø¯ÛŒ - Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡)</label>
          <input class="input" type="date" id="projDate" />
          <div class="muted2 small" id="projDateJ" style="margin-top:6px">â€”</div>
        </div>
        <div>
          <label>ÙˆØ¶Ø¹ÛŒØª</label>
          <select class="input" id="projStatus">
            <option value="todo">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</option>
            <option value="doing">Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…</option>
            <option value="done">Ø§Ù†Ø¬Ø§Ù…â€ŒØ´Ø¯Ù‡</option>
          </select>
        </div>
        <div>
          <label>ØªÚ¯â€ŒÙ‡Ø§ (Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ú©Ù†)</label>
          <input class="input" id="projTags" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø±Ù†Ø¯ÛŒÙ†Ú¯, UI, Ù„ÙˆÚ¯Ùˆ" />
        </div>
        <div class="full">
          <label>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</label>
          <textarea id="projNotes" placeholder="Ù†Ú©Ø§Øª ØªØ­ÙˆÛŒÙ„ØŒ ÙÛŒØ¯Ø¨Ú© Ù…Ø´ØªØ±ÛŒØŒ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§..."></textarea>
        </div>
      </div>
    </div>
    <div class="dlg-foot">
      <button class="btn danger" id="btnProjectDelete" style="visibility:hidden">Ø­Ø°Ù</button>
      <div class="btn-row">
        <button class="btn" data-close="dlgProject">Ø§Ù†ØµØ±Ø§Ù</button>
        <button class="btn primary" id="btnProjectSave">Ø°Ø®ÛŒØ±Ù‡</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgGoal">
    <div class="dlg-head">
      <div>
        <div class="dlg-title" id="dlgGoalTitle">Ø§ÙØ²ÙˆØ¯Ù† Ù‡Ø¯Ù</div>
        <div class="dlg-sub">Ù‡Ø¯Ù Ø¨Ø²Ø±Ú¯ = Ù…Ø³ÛŒØ± Ø±ÙˆØ´Ù†. Ù…Ø§ÛŒÙ„Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ = Ø­Ø±Ú©Øª ÙˆØ§Ù‚Ø¹ÛŒ.</div>
      </div>
      <button class="icon-btn" data-close="dlgGoal" title="Ø¨Ø³ØªÙ†">âœ•</button>
    </div>
    <div class="dlg-body">
      <div class="form-grid">
        <div class="full">
          <label>Ø¹Ù†ÙˆØ§Ù† Ù‡Ø¯Ù</label>
          <input class="input" id="goalTitle" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ Û´Û° Ù…ÛŒÙ„ÛŒÙˆÙ† Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡" />
        </div>
        <div>
          <label>Ø§ÙÙ‚ Ø²Ù…Ø§Ù†ÛŒ</label>
          <input class="input" id="goalHorizon" placeholder="Ù…Ø«Ù„Ø§Ù‹: Û³ Ù…Ø§Ù‡ / Û¶ Ù…Ø§Ù‡" />
        </div>
        <div>
          <label>Ù…ØªØ±ÛŒÚ©</label>
          <input class="input" id="goalMetric" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¯Ø±Ø¢Ù…Ø¯ / ÙˆØ²Ù† / Ø³Ø§Ø¹Øª Ù…Ø·Ø§Ù„Ø¹Ù‡ ..." />
        </div>
        <div>
          <label>Ù‡Ø¯Ù (Target)</label>
          <input class="input" type="number" id="goalTarget" />
        </div>
        <div>
          <label>Ù…Ù‚Ø¯Ø§Ø± ÙØ¹Ù„ÛŒ (Current)</label>
          <input class="input" type="number" id="goalCurrent" />
        </div>
        <div class="full">
          <label>Ù…Ø§ÛŒÙ„Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ (Ù‡Ø± Ø®Ø· ÛŒÚ© Ù…ÙˆØ±Ø¯)</label>
          <textarea id="goalMilestones" placeholder="Ù…Ø«Ù„Ø§Ù‹:
Ù¾ÙˆØ±ØªÙÙˆÙ„ÛŒÙˆ Ø¬Ø¯ÛŒØ¯
Û³ Ú©ÛŒØ³â€ŒØ§Ø³ØªØ§Ø¯ÛŒ Ú©Ø§Ù…Ù„
Ø§ÙØ²Ø§ÛŒØ´ Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ"></textarea>
        </div>
        <div class="full">
          <label>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</label>
          <textarea id="goalNotes" placeholder="ØªÙˆØ¶ÛŒØ­ Ù…Ø³ÛŒØ±ØŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ØŒ Ø¯Ù„ÛŒÙ„ØŒ Ù…Ù†Ø§Ø¨Ø¹..."></textarea>
        </div>
      </div>
    </div>
    <div class="dlg-foot">
      <button class="btn danger" id="btnGoalDelete" style="visibility:hidden">Ø­Ø°Ù</button>
      <div class="btn-row">
        <button class="btn" data-close="dlgGoal">Ø§Ù†ØµØ±Ø§Ù</button>
        <button class="btn primary" id="btnGoalSave">Ø°Ø®ÛŒØ±Ù‡</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgHolding">
    <div class="dlg-head">
      <div>
        <div class="dlg-title" id="dlgHoldingTitle">Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø§Ø±Ø§ÛŒÛŒ</div>
        <div class="dlg-sub">Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ Ø±Ùˆ Ø¯Ù‚ÛŒÙ‚ Ø«Ø¨Øª Ú©Ù† ØªØ§ Ù¾Ø±ØªÙÙˆÛŒ Ù…Ø¹Ù†ÛŒâ€ŒØ¯Ø§Ø± Ø¨Ø´Ù‡.</div>
      </div>
      <button class="icon-btn" data-close="dlgHolding" title="Ø¨Ø³ØªÙ†">âœ•</button>
    </div>
    <div class="dlg-body">
      <div class="form-grid">
        <div>
          <label>Ù†ÙˆØ¹</label>
          <input class="input" id="holdType" placeholder="Ø·Ù„Ø§ / Ù†Ù‚Ø±Ù‡ / XRP / ETH ..." />
        </div>
        <div>
          <label>ÙˆØ§Ø­Ø¯</label>
          <input class="input" id="holdUnit" placeholder="ØªÙˆÙ…Ø§Ù† / Ú¯Ø±Ù… / USDT / USD ..." />
        </div>
        <div class="full">
          <label>Ù…Ù‚Ø¯Ø§Ø±</label>
          <input class="input" type="number" id="holdAmount" />
        </div>
      </div>
    </div>
    <div class="dlg-foot">
      <button class="btn danger" id="btnHoldingDelete" style="visibility:hidden">Ø­Ø°Ù</button>
      <div class="btn-row">
        <button class="btn" data-close="dlgHolding">Ø§Ù†ØµØ±Ø§Ù</button>
        <button class="btn primary" id="btnHoldingSave">Ø°Ø®ÛŒØ±Ù‡</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgImport">
    <div class="dlg-head">
      <div>
        <div class="dlg-title">ÙˆØ±ÙˆØ¯ Ø¯Ø§Ø¯Ù‡ (Import)</div>
        <div class="dlg-sub">ÙØ§ÛŒÙ„ JSON Ø®Ø±ÙˆØ¬ÛŒ Ø±Ùˆ ÙˆØ§Ø±Ø¯ Ú©Ù†.</div>
      </div>
      <button class="icon-btn" data-close="dlgImport" title="Ø¨Ø³ØªÙ†">âœ•</button>
    </div>
    <div class="dlg-body">
      <label>ÙØ§ÛŒÙ„ Ø®Ø±ÙˆØ¬ÛŒ (JSON)</label>
      <input class="input" type="file" id="importFile" accept=".json,application/json" />
      <div class="sep"></div>
      <div class="muted small">
        Ù‡Ø´Ø¯Ø§Ø±: Import Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ù‚Ø¨Ù„Ø´ Export Ø¨Ú¯ÛŒØ±.
      </div>
    </div>
    <div class="dlg-foot">
      <button class="btn" data-close="dlgImport">Ø§Ù†ØµØ±Ø§Ù</button>
      <button class="btn primary" id="btnImportDo">ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù†</button>
    </div>
  </dialog>

  <div class="toast" id="toast"></div>

<script>
(() => {
  // =========================
  // PWA Service Worker
  // =========================
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./service-worker.js").catch(() => {});
    });
  }

  // =========================
  // Jalali (Shamsi) Conversion
  // Based on jalaali-js algorithm (MIT).
  // =========================
  function div(a, b) { return ~~(a / b); }
  function mod(a, b) { return a - ~~(a / b) * b; }

  const breaks = [-61, 9, 38, 199, 426, 686, 756, 818, 1111, 1181, 1210, 1635, 2060, 2097, 2192, 2262, 2324, 2394, 2456, 3178];

  function jalCal(jy) {
    let bl = breaks.length,
        gy = jy + 621,
        leapJ = -14,
        jp = breaks[0],
        jm,
        jump,
        leap,
        leapG,
        march,
        n,
        i;

    if (jy < jp || jy >= breaks[bl - 1])
      throw new Error('Invalid Jalali year ' + jy);

    for (i = 1; i < bl; i += 1) {
      jm = breaks[i];
      jump = jm - jp;
      if (jy < jm)
        break;
      leapJ = leapJ + div(jump, 33) * 8 + div(mod(jump, 33), 4);
      jp = jm;
    }
    n = jy - jp;

    leapJ = leapJ + div(n, 33) * 8 + div(mod(n, 33) + 3, 4);
    if (mod(jump, 33) === 4 && jump - n === 4)
      leapJ += 1;

    leapG = div(gy, 4) - div((div(gy, 100) + 1) * 3, 4) - 150;
    march = 20 + leapJ - leapG;

    if (jump - n < 6)
      n = n - jump + div(jump + 4, 33) * 33;
    leap = mod(mod(n + 1, 33) - 1, 4);
    if (leap === -1) {
      leap = 4;
    }

    return { leap: leap, gy: gy, march: march };
  }

  function isLeapJalaaliYear(jy) { return jalCal(jy).leap === 0; }

  function jalaaliMonthLength(jy, jm) {
    if (jm <= 6) return 31;
    if (jm <= 11) return 30;
    return isLeapJalaaliYear(jy) ? 30 : 29;
  }

  function g2d(gy, gm, gd) {
    let d = div((gy + div(gm - 8, 6) + 100100) * 1461, 4)
      + div(153 * mod(gm + 9, 12) + 2, 5)
      + gd - 34840408;
    d = d - div(div(gy + 100100 + div(gm - 8, 6), 100) * 3, 4) + 752;
    return d;
  }

  function d2g(jdn) {
    let j = 4 * jdn + 139361631;
    j = j + div(div(4 * jdn + 183187720, 146097) * 3, 4) * 4 - 3908;
    let i = div(mod(j, 1461), 4) * 5 + 308;
    let gd = div(mod(i, 153), 5) + 1;
    let gm = mod(div(i, 153), 12) + 1;
    let gy = div(j, 1461) - 100100 + div(8 - gm, 6);
    return { gy: gy, gm: gm, gd: gd };
  }

  function j2d(jy, jm, jd) {
    let r = jalCal(jy);
    return g2d(r.gy, 3, r.march) + (jm - 1) * 31 - div(jm, 7) * (jm - 7) + jd - 1;
  }

  function d2j(jdn) {
    let g = d2g(jdn),
        gy = g.gy,
        gm = g.gm,
        gd = g.gd,
        jy = gy - 621,
        r = jalCal(jy),
        jdn1f = g2d(gy, 3, r.march),
        jd,
        jm,
        k;

    k = jdn - jdn1f;
    if (k >= 0) {
      if (k <= 185) {
        jm = 1 + div(k, 31);
        jd = mod(k, 31) + 1;
        return { jy: jy, jm: jm, jd: jd };
      } else {
        k -= 186;
      }
    } else {
      jy -= 1;
      k += 179;
      if (r.leap === 1)
        k += 1;
    }
    jm = 7 + div(k, 30);
    jd = mod(k, 30) + 1;
    return { jy: jy, jm: jm, jd: jd };
  }

  function toJalaali(gy, gm, gd) { return d2j(g2d(gy, gm, gd)); }
  function toGregorian(jy, jm, jd) { return d2g(j2d(jy, jm, jd)); }

  const J_MONTHS = ["ÙØ±ÙˆØ±Ø¯ÛŒÙ†","Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª","Ø®Ø±Ø¯Ø§Ø¯","ØªÛŒØ±","Ù…Ø±Ø¯Ø§Ø¯","Ø´Ù‡Ø±ÛŒÙˆØ±","Ù…Ù‡Ø±","Ø¢Ø¨Ø§Ù†","Ø¢Ø°Ø±","Ø¯ÛŒ","Ø¨Ù‡Ù…Ù†","Ø§Ø³ÙÙ†Ø¯"];
  const FA_DIGITS = "Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹";
  const toFaDigits = (s) => String(s).replace(/\d/g, d => FA_DIGITS[d]);
  const pad2 = (n) => (n < 10 ? "0" + n : "" + n);
  const isoToParts = (iso) => {
    const [y,m,d] = String(iso).split("-").map(Number);
    return { y, m, d };
  };
  const isoToJalali = (iso) => {
    const p = isoToParts(iso);
    return toJalaali(p.y, p.m, p.d);
  };
  const jalaliToISO = (jy, jm, jd) => {
    const g = toGregorian(jy, jm, jd);
    return `${g.gy}-${pad2(g.gm)}-${pad2(g.gd)}`;
  };
  const jalaliDateStr = (jy, jm, jd) => toFaDigits(`${jy}/${pad2(jm)}/${pad2(jd)}`);
  const isoToJalaliStr = (iso) => {
    const j = isoToJalali(iso);
    return jalaliDateStr(j.jy, j.jm, j.jd);
  };
  const jalaliMonthLabel = (jy, jm) => `${J_MONTHS[jm-1]} ${toFaDigits(jy)}`;

  const shiftJalaliMonth = (jy, jm, delta) => {
    let y = jy, m = jm + delta;
    while (m > 12) { m -= 12; y += 1; }
    while (m < 1) { m += 12; y -= 1; }
    return { jy: y, jm: m };
  };

  const jalaliMonthRangeISO = (jy, jm) => {
    const start = toGregorian(jy, jm, 1);
    const endDay = jalaaliMonthLength(jy, jm);
    const end = toGregorian(jy, jm, endDay);
    const s = `${start.gy}-${pad2(start.gm)}-${pad2(start.gd)}`;
    const e = `${end.gy}-${pad2(end.gm)}-${pad2(end.gd)}`;
    return { s, e };
  };

  // =========================
  // Storage & Helpers
  // =========================
  const STORAGE_KEY = "armin_os_v1"; // keep stable
  const LOCK_SESSION_KEY = "arminos_unlocked";
  const PIN_CODE = "5823"; // requested PIN

  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
  const uid = () => (Math.random().toString(36).slice(2, 10) + "_" + Date.now().toString(36));
  const todayISO = () => {
    const d = new Date();
    return d.getFullYear() + "-" + pad2(d.getMonth()+1) + "-" + pad2(d.getDate());
  };
  const moneyFA = (n) => Number(n||0).toLocaleString("fa-IR");
  const safeParse = (raw) => { try { return JSON.parse(raw); } catch { return null; } };

  const defaultState = () => {
    const t = todayISO();
    return {
      meta: { version: 3, createdAt: new Date().toISOString() },
      profile: {
        name: "Ø¢Ø±Ù…ÛŒÙ†",
        title: "ÙØ±ÛŒÙ„Ù†Ø³Ø± â€¢ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒ Ù…Ù‡Ù†Ø¯Ø³ÛŒ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±",
        monthlyMinIncome: 20000000,
        savingsRateTarget: 0.30,
        currency: "ØªÙˆÙ…Ø§Ù†"
      },
      settings: { theme: "dark", rtl: true },
      notes: {
        daily: "Ø§Ù…Ø±ÙˆØ² ÙÙ‚Ø· ÛŒÚ© Ù‚Ø¯Ù… Ú©ÙˆÚ†Ú© â€” ÙˆÙ„ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ.",
        motivation: "ØªÙ…Ø±Ú©Ø² Ø±ÙˆÛŒ Ø³ÛŒØ³ØªÙ…ØŒ Ù†Ù‡ Ù‡ÛŒØ¬Ø§Ù†.",
        journal: "",
        ideas: ""
      },
      tasks: [
        { id: uid(), title: "Û³Û° Ø¯Ù‚ÛŒÙ‚Ù‡ ØªÙ…Ø±ÛŒÙ† UI", date: t, done: false, priority: "medium", category: "Ù…Ù‡Ø§Ø±Øª", timeBlock: "ØµØ¨Ø­", estimateMin: 30 },
        { id: uid(), title: "Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ù…Ø´ØªØ±ÛŒ", date: t, done: true, priority: "high", category: "Ú©Ø§Ø±", timeBlock: "Ø¹ØµØ±", estimateMin: 20 },
      ],
      projects: [
        { id: uid(), name: "Ø·Ø±Ø§Ø­ÛŒ Ù‡ÙˆÛŒØª Ø¨ØµØ±ÛŒ", client: "Ù†Ù…ÙˆÙ†Ù‡", amount: 6500000, date: t, status: "done", tags: ["Ø¨Ø±Ù†Ø¯ÛŒÙ†Ú¯"], notes: "ØªØ­ÙˆÛŒÙ„ Ø´Ø¯ â€” ÙÛŒØ¯Ø¨Ú© Ø¹Ø§Ù„ÛŒ" }
      ],
      goals: [
        {
          id: uid(),
          title: "Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ Û´Û° Ù…ÛŒÙ„ÛŒÙˆÙ† Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡",
          horizon: "Û¶ Ù…Ø§Ù‡",
          metric: "Ø¯Ø±Ø¢Ù…Ø¯",
          target: 40000000,
          current: 20000000,
          notes: "Ø§ÙØ²Ø§ÛŒØ´ Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ + Ø¬Ø°Ø¨ Ù…Ø´ØªØ±ÛŒ Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ",
          milestones: [
            { id: uid(), text: "Ù¾ÙˆØ±ØªÙÙˆÙ„ÛŒÙˆ Ø¬Ø¯ÛŒØ¯", done: true },
            { id: uid(), text: "Û³ Ú©ÛŒØ³â€ŒØ§Ø³ØªØ§Ø¯ÛŒ Ú©Ø§Ù…Ù„", done: false }
          ]
        }
      ],
      assets: {
        holdings: [
          { id: uid(), type: "Ø·Ù„Ø§", amount: 18000000, unit: "ØªÙˆÙ…Ø§Ù†" },
          { id: uid(), type: "Ù†Ù‚Ø±Ù‡", amount: 3000000, unit: "ØªÙˆÙ…Ø§Ù†" },
          { id: uid(), type: "XRP", amount: 80, unit: "USDT" },
          { id: uid(), type: "ETH", amount: 15, unit: "USD" },
          { id: uid(), type: "TON", amount: 10, unit: "USD" },
          { id: uid(), type: "NOT", amount: 5, unit: "USD" }
        ],
        plan: { split: { gold: 40, crypto: 45, silver: 10, cash: 5 } }
      }
    };
  };

  const loadState = () => {
    const raw = localStorage.getItem(STORAGE_KEY);
    const parsed = raw ? safeParse(raw) : null;
    return parsed && parsed.meta ? parsed : null;
  };
  let state = loadState() || defaultState();
  const saveState = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(state));

  const toast = (msg) => {
    const el = $("#toast");
    el.textContent = msg;
    el.style.display = "block";
    clearTimeout(el._t);
    el._t = setTimeout(() => el.style.display = "none", 2200);
  };

  // =========================
  // PIN Lock
  // =========================
  const showLock = () => {
    const lock = $("#lockScreen");
    lock.style.display = "flex";
    lock.setAttribute("aria-hidden", "false");
    $("#lockError").textContent = "";
    clearPinInputs();
    setTimeout(() => pinInputs()[0]?.focus(), 50);
  };
  const hideLock = () => {
    const lock = $("#lockScreen");
    lock.style.display = "none";
    lock.setAttribute("aria-hidden", "true");
  };

  const pinInputs = () => $$(".pin", $("#pinRow"));
  const clearPinInputs = () => pinInputs().forEach(i => i.value = "");
  const getPinValue = () => pinInputs().map(i => i.value).join("");

  const tryUnlock = () => {
    const val = getPinValue();
    if (val.length < 4) {
      $("#lockError").textContent = "Ù¾ÛŒÙ† Ø¨Ø§ÛŒØ¯ Û´ Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯.";
      return;
    }
    if (val === PIN_CODE) {
      sessionStorage.setItem(LOCK_SESSION_KEY, "1");
      hideLock();
      toast("Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ âœ…");
    } else {
      $("#lockError").textContent = "Ù¾ÛŒÙ† Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª.";
      clearPinInputs();
      pinInputs()[0]?.focus();
    }
  };

  const initLock = () => {
    // init inputs behavior
    const inputs = pinInputs();

    inputs.forEach((inp, idx) => {
      inp.addEventListener("input", (e) => {
        const v = (inp.value || "").replace(/\D/g, "");
        inp.value = v.slice(0,1);
        if (inp.value && idx < inputs.length - 1) inputs[idx+1].focus();
        if (getPinValue().length === 4) tryUnlock();
      });

      inp.addEventListener("keydown", (e) => {
        if (e.key === "Backspace" && !inp.value && idx > 0) {
          inputs[idx-1].focus();
        }
        if (e.key === "Enter") {
          e.preventDefault();
          tryUnlock();
        }
      });

      inp.addEventListener("paste", (e) => {
        const text = (e.clipboardData || window.clipboardData).getData("text");
        if (!text) return;
        const digits = text.replace(/\D/g, "").slice(0,4).split("");
        if (digits.length) {
          e.preventDefault();
          clearPinInputs();
          digits.forEach((d, i) => { if (inputs[i]) inputs[i].value = d; });
          if (digits.length === 4) tryUnlock();
          else inputs[Math.min(digits.length, 3)].focus();
        }
      });
    });

    $("#btnUnlock").addEventListener("click", tryUnlock);
    $("#btnClearPin").addEventListener("click", () => { clearPinInputs(); $("#lockError").textContent = ""; pinInputs()[0]?.focus(); });
    $("#btnLock").addEventListener("click", () => { sessionStorage.removeItem(LOCK_SESSION_KEY); showLock(); });

    const unlocked = sessionStorage.getItem(LOCK_SESSION_KEY) === "1";
    if (unlocked) hideLock(); else showLock();
  };

  // =========================
  // Date & Week helpers
  // =========================
  const getFaWeekdayIndex = (date) => {
    // JS: 0 Sun..6 Sat -> Persian week index: Sat=0..Fri=6
    const js = new Date(date).getDay();
    return (js + 1) % 7;
  };
  const faDow = ["Ø´Ù†Ø¨Ù‡","ÛŒÚ©Ø´Ù†Ø¨Ù‡","Ø¯ÙˆØ´Ù†Ø¨Ù‡","Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡","Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡","Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡","Ø¬Ù…Ø¹Ù‡"];

  // =========================
  // Navigation
  // =========================
  const viewMeta = {
    dashboard: { title: "Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯", sub: "Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ Ù¾ÛŒØ´Ø±ÙØªØŒ Ø¯Ø±Ø¢Ù…Ø¯ØŒ Ø³Ø±Ù…Ø§ÛŒÙ‡ Ùˆ Ø§Ù‡Ø¯Ø§Ù" },
    planner:   { title: "Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡", sub: "Ù…Ø¯ÛŒØ±ÛŒØª ØªØ³Ú©â€ŒÙ‡Ø§ Ø¨Ø§ ØªØ§Ø±ÛŒØ® Ùˆ Ø§ÙˆÙ„ÙˆÛŒØª Ùˆ ØªØ§ÛŒÙ…â€ŒØ¨Ù„Ø§Ú©" },
    calendar:  { title: "ØªÙ‚ÙˆÛŒÙ… (Ø´Ù…Ø³ÛŒ)", sub: "Ù†Ù…Ø§ÛŒ Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø´Ù…Ø³ÛŒ + Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø±ÙˆØ² Ø¨Ø±Ø§ÛŒ Ø±ÙØªÙ† Ø¨Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡" },
    projects:  { title: "Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§", sub: "Ø«Ø¨Øª Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ Ùˆ Ø¯Ø±Ø¢Ù…Ø¯ Ùˆ ÙˆØ¶Ø¹ÛŒØª Ù¾ÛŒØ´Ø±ÙØª" },
    goals:     { title: "Ø§Ù‡Ø¯Ø§Ù Ø¨Ø²Ø±Ú¯", sub: "Ø§Ù‡Ø¯Ø§Ù + Ù…Ø§ÛŒÙ„Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ + Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª" },
    finance:   { title: "Ø³Ø±Ù…Ø§ÛŒÙ‡", sub: "Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ + Ù¾Ù„Ù† ØªÙ‚Ø³ÛŒÙ… Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ" },
    notes:     { title: "ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§", sub: "Ú˜ÙˆØ±Ù†Ø§Ù„ + Ø¬Ù…Ù„Ù‡ Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ + Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§" }
  };

  const showView = (name) => {
    $$(".view").forEach(v => v.classList.remove("active"));
    $("#view-" + name).classList.add("active");
    $$("#nav button").forEach(b => b.classList.toggle("active", b.dataset.view === name));
    $("#viewTitle").textContent = viewMeta[name].title;
    $("#viewSub").textContent = viewMeta[name].sub;
    if (name === "dashboard") renderDashboardCharts();
  };

  $("#nav").addEventListener("click", (e) => {
    const btn = e.target.closest("button[data-view]");
    if(!btn) return;
    showView(btn.dataset.view);
  });

  // Dialog helpers
  const openDlg = (id) => { const d = $("#"+id); if (d) d.showModal(); };
  const closeDlg = (id) => { const d = $("#"+id); if (d) d.close(); };
  document.addEventListener("click", (e) => {
    const c = e.target.closest("[data-close]");
    if(!c) return;
    closeDlg(c.dataset.close);
  });

  // =========================
  // Header Render
  // =========================
  const renderHeader = () => {
    $("#pname").textContent = state.profile.name || "â€”";
    $("#ptitle").textContent = state.profile.title || "";
    $("#avatar").textContent = (state.profile.name || "A").trim().slice(0,1).toUpperCase();

    const tISO = todayISO();
    const tJ = isoToJalaliStr(tISO);
    const j = isoToJalali(tISO);

    $("#todayBadge").textContent = "Ø§Ù…Ø±ÙˆØ²: " + tJ + " â€¢ " + tISO;
    $("#monthBadge").textContent = "Ù…Ø§Ù‡: " + jalaliMonthLabel(j.jy, j.jm);
    document.documentElement.setAttribute("dir", state.settings.rtl ? "rtl" : "ltr");
    document.documentElement.setAttribute("data-theme", state.settings.theme || "dark");
  };

  // =========================
  // Metrics
  // =========================
  const tasksByDate = (iso) => state.tasks.filter(t => t.date === iso);
  const projectsInRange = (s,e) => state.projects.filter(p => p.date >= s && p.date <= e);
  const calcTaskRate = (tasks) => {
    if(!tasks.length) return { total:0, done:0, rate:0 };
    const done = tasks.filter(x=>x.done).length;
    return { total:tasks.length, done, rate: Math.round(done/tasks.length*100) };
  };
  const calcIncome = (projects) => projects.reduce((sum,p)=>sum + Number(p.amount||0), 0);

  const currentJalaliYM = () => {
    const t = isoToJalali(todayISO());
    return { jy: t.jy, jm: t.jm };
  };

  // =========================
  // Dashboard
  // =========================
  let chartWeek = null, chartIncome = null, chartPortfolio = null;

  const renderDashboard = () => {
    const t = todayISO();
    const todayTasks = tasksByDate(t);
    const todayStats = calcTaskRate(todayTasks);

    const { jy, jm } = currentJalaliYM();
    const m = jalaliMonthRangeISO(jy, jm);

    const monthTasks = state.tasks.filter(x => x.date >= m.s && x.date <= m.e);
    const monthStats = calcTaskRate(monthTasks);

    const monthProjects = projectsInRange(m.s, m.e);
    const income = calcIncome(monthProjects);

    $("#dashTodayChip").textContent = todayStats.rate + "%";
    $("#dashTodayKpi").textContent = todayStats.done + " / " + todayStats.total;
    $("#dashTodayMeta").textContent = "Ø§Ù†Ø¬Ø§Ù…â€ŒØ´Ø¯Ù‡ / Ú©Ù„ ØªØ³Ú©â€ŒÙ‡Ø§";
    $("#dashTodayBar").style.width = todayStats.rate + "%";

    $("#dashMonthChip").textContent = monthStats.rate + "%";
    $("#dashMonthKpi").textContent = monthStats.done + " / " + monthStats.total;
    $("#dashMonthMeta").textContent = "Ù¾ÛŒØ´Ø±ÙØª Ù…Ø§Ù‡ (" + jalaliMonthLabel(jy, jm) + ")";
    $("#dashMonthBar").style.width = monthStats.rate + "%";

    $("#dashIncomeKpi").textContent = moneyFA(income) + " " + state.profile.currency;
    $("#dashIncomeMeta").textContent = monthProjects.length + " Ù¾Ø±ÙˆÚ˜Ù‡ Ø¯Ø± Ø§ÛŒÙ† Ù…Ø§Ù‡";

    const saveTarget = Math.round(Number(state.profile.monthlyMinIncome||0) * Number(state.profile.savingsRateTarget||0));
    $("#dashSaveTarget").textContent = moneyFA(saveTarget) + " " + state.profile.currency;
    $("#dashSaveRate").textContent = Math.round((Number(state.profile.savingsRateTarget||0))*100) + "%";

    $("#dashMotivation").textContent = state.notes.motivation || "â€”";
  };

  const renderDashboardCharts = () => {
    const hasChart = typeof window.Chart !== "undefined";
    const showFallback = (id, show) => { const el = $(id); if(el) el.style.display = show ? "block" : "none"; };

    if(!hasChart){
      showFallback("#chartWeekFallback", true);
      showFallback("#chartIncomeFallback", true);
      showFallback("#chartPortfolioFallback", true);
      return;
    }
    showFallback("#chartWeekFallback", false);
    showFallback("#chartIncomeFallback", false);
    showFallback("#chartPortfolioFallback", false);

    [chartWeek, chartIncome, chartPortfolio].forEach(ch => { if(ch) ch.destroy(); });

    // Weekly completion
    const labels = [];
    const values = [];
    const now = new Date();
    for(let i=6;i>=0;i--){
      const d = new Date(now);
      d.setDate(d.getDate()-i);
      const iso = d.getFullYear()+"-"+pad2(d.getMonth()+1)+"-"+pad2(d.getDate());
      const s = calcTaskRate(tasksByDate(iso));
      labels.push(isoToJalaliStr(iso).slice(5)); // MM/DD in jalali digits
      values.push(s.rate);
    }

    chartWeek = new Chart($("#chartWeek"), {
      type: "line",
      data: { labels, datasets: [{ label: "Ø¯Ø±ØµØ¯ Ø§Ù†Ø¬Ø§Ù… ØªØ³Ú©", data: values, tension: .35, fill: true }] },
      options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{ display:false } },
        scales:{ y:{ min:0, max:100, ticks:{ callback:(v)=> v+"%" } } }
      }
    });

    // Income last 6 Jalali months
    const { jy, jm } = currentJalaliYM();
    const incLabels = [];
    const incValues = [];
    for(let i=5;i>=0;i--){
      const m = shiftJalaliMonth(jy, jm, -i);
      const r = jalaliMonthRangeISO(m.jy, m.jm);
      const inc = calcIncome(projectsInRange(r.s, r.e));
      incLabels.push(jalaliMonthLabel(m.jy, m.jm));
      incValues.push(inc);
    }

    chartIncome = new Chart($("#chartIncome"), {
      type: "bar",
      data: { labels: incLabels, datasets: [{ label: "Ø¯Ø±Ø¢Ù…Ø¯", data: incValues }] },
      options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{ display:false } },
        scales:{ y:{ ticks:{ callback:(v)=> moneyFA(v) } } }
      }
    });

    // Portfolio (grouped by type+unit)
    const groups = new Map();
    for(const h of state.assets.holdings){
      const key = `${h.type} (${h.unit})`;
      groups.set(key, (groups.get(key)||0) + Number(h.amount||0));
    }
    chartPortfolio = new Chart($("#chartPortfolio"), {
      type: "doughnut",
      data: { labels: Array.from(groups.keys()), datasets: [{ data: Array.from(groups.values()) }] },
      options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:"bottom" } } }
    });
  };

  // =========================
  // Planner (Tasks)
  // =========================
  let plannerDate = todayISO();
  let showDone = true;
  let editingTaskId = null;

  const priorityLabel = (p) => (p==="high" ? "Ø§ÙˆÙ„ÙˆÛŒØª Ø²ÛŒØ§Ø¯" : (p==="low" ? "Ø§ÙˆÙ„ÙˆÛŒØª Ú©Ù…" : "Ø§ÙˆÙ„ÙˆÛŒØª Ù…ØªÙˆØ³Ø·"));

  const renderPlanner = () => {
    $("#plannerDate").value = plannerDate;
    $("#plannerJalaliBadge").textContent = isoToJalaliStr(plannerDate);

    const tasks = tasksByDate(plannerDate).slice().sort((a,b) => (a.done===b.done ? 0 : (a.done?1:-1)));
    const filtered = showDone ? tasks : tasks.filter(t => !t.done);
    const stats = calcTaskRate(tasks);

    $("#plannerCount").textContent = stats.total;
    $("#plannerDone").textContent = stats.done;
    $("#plannerRate").textContent = stats.rate + "%";
    $("#plannerBar").style.width = stats.rate + "%";
    $("#showDoneState").textContent = showDone ? "Ø±ÙˆØ´Ù†" : "Ø®Ø§Ù…ÙˆØ´";

    const list = $("#plannerList");
    list.innerHTML = "";
    $("#plannerEmpty").style.display = tasks.length ? "none" : "block";

    filtered.forEach(t => {
      const priChip = t.priority === "high" ? "chip danger" : (t.priority === "low" ? "chip" : "chip acc");
      const doneChip = t.done ? "mini ok" : "mini";
      const item = document.createElement("div");
      item.className = "item";
      item.innerHTML = `
        <div class="item-main">
          <div class="item-title">${escapeHtml(t.title)}</div>
          <div class="item-meta">
            <span class="mini">${escapeHtml(t.category || "â€”")}</span>
            <span class="mini acc">${escapeHtml(t.timeBlock || "â€”")}</span>
            <span class="${priChip}">${priorityLabel(t.priority)}</span>
            <span class="${doneChip}">${t.done ? "Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯" : "Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±"}</span>
            <span class="mini">â± ${Number(t.estimateMin||0)} Ø¯Ù‚ÛŒÙ‚Ù‡</span>
          </div>
        </div>
        <div class="item-actions">
          <button class="icon-btn" title="ØªÛŒÚ©" data-act="toggle" data-id="${t.id}">âœ“</button>
          <button class="icon-btn" title="ÙˆÛŒØ±Ø§ÛŒØ´" data-act="edit" data-id="${t.id}">âœ</button>
          <button class="icon-btn danger" title="Ø­Ø°Ù" data-act="del" data-id="${t.id}">ğŸ—‘</button>
        </div>
      `;
      list.appendChild(item);
    });
  };

  const openTaskDialog = (task=null) => {
    editingTaskId = task ? task.id : null;
    $("#dlgTaskTitle").textContent = task ? "ÙˆÛŒØ±Ø§ÛŒØ´ ØªØ³Ú©" : "Ø§ÙØ²ÙˆØ¯Ù† ØªØ³Ú©";
    $("#btnTaskDelete").style.visibility = task ? "visible" : "hidden";

    $("#taskTitle").value = task ? task.title : "";
    $("#taskDate").value = task ? task.date : plannerDate;
    $("#taskDateJ").textContent = isoToJalaliStr($("#taskDate").value || plannerDate);

    $("#taskPriority").value = task ? task.priority : "medium";
    $("#taskCategory").value = task ? task.category : "Ú©Ø§Ø±";
    $("#taskTimeBlock").value = task ? task.timeBlock : "ØµØ¨Ø­";
    $("#taskEstimate").value = task ? Number(task.estimateMin||0) : 30;
    $("#taskDone").checked = task ? !!task.done : false;

    openDlg("dlgTask");
  };

  $("#taskDate").addEventListener("change", (e) => {
    const iso = e.target.value || plannerDate;
    $("#taskDateJ").textContent = isoToJalaliStr(iso);
  });

  $("#plannerDate").addEventListener("change", (e) => {
    plannerDate = e.target.value || todayISO();
    renderPlanner();
  });

  $("#btnAddTask").addEventListener("click", () => { showView("planner"); openTaskDialog(null); });
  $("#btnAddTask2").addEventListener("click", () => openTaskDialog(null));

  $("#btnQuickAdd").addEventListener("click", () => {
    const title = $("#quickTaskTitle").value.trim();
    if(!title){ toast("Ø¹Ù†ÙˆØ§Ù† ØªØ³Ú© Ø±Ùˆ Ø¨Ù†ÙˆÛŒØ³."); return; }
    state.tasks.unshift({ id: uid(), title, date: plannerDate, done:false, priority:"medium", category:"Ú©Ø§Ø±", timeBlock:"ØµØ¨Ø­", estimateMin:30 });
    $("#quickTaskTitle").value = "";
    saveState(); renderPlanner(); renderDashboard(); renderDashboardCharts();
    toast("ØªØ³Ú© Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ âœ…");
  });

  $("#toggleShowDone").addEventListener("click", () => { showDone = !showDone; renderPlanner(); });

  $("#plannerList").addEventListener("click", (e) => {
    const btn = e.target.closest("[data-act]");
    if(!btn) return;
    const id = btn.dataset.id;
    const act = btn.dataset.act;
    const task = state.tasks.find(t => t.id === id);
    if(!task) return;

    if(act==="toggle"){ task.done = !task.done; saveState(); renderPlanner(); renderDashboard(); renderDashboardCharts(); return; }
    if(act==="edit"){ openTaskDialog(task); return; }
    if(act==="del"){
      state.tasks = state.tasks.filter(t => t.id !== id);
      saveState(); renderPlanner(); renderDashboard(); renderDashboardCharts();
      toast("Ø­Ø°Ù Ø´Ø¯.");
      return;
    }
  });

  $("#btnTaskSave").addEventListener("click", () => {
    const title = $("#taskTitle").value.trim();
    const date = $("#taskDate").value || plannerDate;
    if(!title){ toast("Ø¹Ù†ÙˆØ§Ù† Ø¶Ø±ÙˆØ±ÛŒÙ‡."); return; }

    const patch = {
      title,
      date,
      priority: $("#taskPriority").value,
      category: $("#taskCategory").value.trim() || "Ú©Ø§Ø±",
      timeBlock: $("#taskTimeBlock").value,
      estimateMin: Number($("#taskEstimate").value || 0),
      done: $("#taskDone").checked
    };

    if(editingTaskId){
      const idx = state.tasks.findIndex(t => t.id === editingTaskId);
      if(idx >= 0) state.tasks[idx] = { ...state.tasks[idx], ...patch };
      toast("ØªØ³Ú© Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯ âœ…");
    } else {
      state.tasks.unshift({ id: uid(), ...patch });
      toast("ØªØ³Ú© Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ âœ…");
    }

    plannerDate = date;
    saveState();
    closeDlg("dlgTask");
    renderAll();
    renderDashboardCharts();
  });

  $("#btnTaskDelete").addEventListener("click", () => {
    if(!editingTaskId) return;
    state.tasks = state.tasks.filter(t => t.id !== editingTaskId);
    saveState();
    closeDlg("dlgTask");
    renderAll();
    renderDashboardCharts();
    toast("ØªØ³Ú© Ø­Ø°Ù Ø´Ø¯.");
  });

  // =========================
  // Calendar (Jalali cursor)
  // =========================
  let monthCursor = currentJalaliYM(); // {jy,jm}

  const renderCalendar = () => {
    $("#calMonthLabel").textContent = jalaliMonthLabel(monthCursor.jy, monthCursor.jm);

    // DOW header
    const dow = $("#calDow");
    dow.innerHTML = "";
    faDow.forEach(name => { const d = document.createElement("div"); d.className = "cal-dow"; d.textContent = name; dow.appendChild(d); });

    // first day of jalali month -> gregorian date
    const gFirst = toGregorian(monthCursor.jy, monthCursor.jm, 1);
    const firstDate = new Date(gFirst.gy, gFirst.gm - 1, gFirst.gd);
    const lead = getFaWeekdayIndex(firstDate);

    const totalDays = jalaaliMonthLength(monthCursor.jy, monthCursor.jm);

    const grid = $("#calGrid");
    grid.innerHTML = "";

    for(let i=0;i<lead;i++){
      const cell = document.createElement("div");
      cell.className = "cal-day blank";
      cell.innerHTML = `<div class="cal-top"><span class="cal-num">â€”</span></div>`;
      grid.appendChild(cell);
    }

    for(let jd=1; jd<=totalDays; jd++){
      const iso = jalaliToISO(monthCursor.jy, monthCursor.jm, jd);

      const dayTasks = tasksByDate(iso);
      const done = dayTasks.filter(t=>t.done).length;
      const dayProjects = state.projects.filter(p=>p.date === iso);
      const inc = calcIncome(dayProjects);

      const cell = document.createElement("div");
      cell.className = "cal-day";
      cell.dataset.iso = iso;
      cell.innerHTML = `
        <div class="cal-top">
          <span class="cal-num">${toFaDigits(jd)}</span>
          <span class="mini">${isoToJalaliStr(iso)}</span>
        </div>
        <div class="cal-badges">
          <span class="mini acc">ØªØ³Ú©: ${toFaDigits(dayTasks.length)}</span>
          <span class="mini ok">Ø§Ù†Ø¬Ø§Ù…: ${toFaDigits(done)}</span>
          <span class="mini">Ù¾Ø±ÙˆÚ˜Ù‡: ${toFaDigits(dayProjects.length)}</span>
          ${inc ? `<span class="mini acc">Ø¯Ø±Ø¢Ù…Ø¯: ${moneyFA(inc)}</span>` : ""}
        </div>
      `;
      grid.appendChild(cell);
    }
  };

  $("#btnPrevMonth").addEventListener("click", () => {
    monthCursor = shiftJalaliMonth(monthCursor.jy, monthCursor.jm, -1);
    renderCalendar();
  });
  $("#btnNextMonth").addEventListener("click", () => {
    monthCursor = shiftJalaliMonth(monthCursor.jy, monthCursor.jm, +1);
    renderCalendar();
  });

  $("#calGrid").addEventListener("click", (e) => {
    const cell = e.target.closest(".cal-day");
    if(!cell || cell.classList.contains("blank")) return;
    const iso = cell.dataset.iso;
    if(!iso) return;
    plannerDate = iso;
    showView("planner");
    renderPlanner();
  });

  // =========================
  // Projects
  // =========================
  let editingProjectId = null;
  const statusLabel = (s) => (s==="done" ? "Ø§Ù†Ø¬Ø§Ù…â€ŒØ´Ø¯Ù‡" : (s==="doing" ? "Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…" : "Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±"));

  const openProjectDialog = (proj=null) => {
    editingProjectId = proj ? proj.id : null;
    $("#dlgProjectTitle").textContent = proj ? "ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±ÙˆÚ˜Ù‡" : "Ø§ÙØ²ÙˆØ¯Ù† Ù¾Ø±ÙˆÚ˜Ù‡";
    $("#btnProjectDelete").style.visibility = proj ? "visible" : "hidden";

    $("#projName").value = proj ? proj.name : "";
    $("#projClient").value = proj ? proj.client : "";
    $("#projAmount").value = proj ? Number(proj.amount||0) : "";
    $("#projDate").value = proj ? proj.date : todayISO();
    $("#projDateJ").textContent = isoToJalaliStr($("#projDate").value || todayISO());
    $("#projStatus").value = proj ? proj.status : "todo";
    $("#projTags").value = proj ? (proj.tags||[]).join(", ") : "";
    $("#projNotes").value = proj ? (proj.notes||"") : "";

    openDlg("dlgProject");
  };

  $("#projDate").addEventListener("change", (e) => {
    const iso = e.target.value || todayISO();
    $("#projDateJ").textContent = isoToJalaliStr(iso);
  });

  const renderProjects = () => {
    const filter = $("#projectFilter").value || "all";
    const tbody = $("#projectTbody");
    tbody.innerHTML = "";

    const { jy, jm } = currentJalaliYM();
    const nowRange = jalaliMonthRangeISO(jy, jm);
    const monthProjects = projectsInRange(nowRange.s, nowRange.e);
    $("#projMonthCount").textContent = toFaDigits(monthProjects.length);
    $("#projMonthIncome").textContent = moneyFA(calcIncome(monthProjects)) + " " + state.profile.currency;

    const list = (filter==="all") ? state.projects : state.projects.filter(p => p.status === filter);
    $("#projectsEmpty").style.display = list.length ? "none" : "block";

    list.forEach(p => {
      const tr = document.createElement("tr");
      const chipClass = p.status==="done" ? "chip ok" : (p.status==="doing" ? "chip acc" : "chip");
      tr.innerHTML = `
        <td><b>${escapeHtml(p.name)}</b><div class="muted2 small">${(p.tags||[]).map(t=>"#"+escapeHtml(t)).join(" ")}</div></td>
        <td>${escapeHtml(p.client||"â€”")}</td>
        <td class="nowrap">${moneyFA(p.amount)} ${state.profile.currency}</td>
        <td class="nowrap"><b>${isoToJalaliStr(p.date)}</b><div class="muted2 small">${escapeHtml(p.date)}</div></td>
        <td><span class="${chipClass}">${statusLabel(p.status)}</span></td>
        <td class="nowrap">
          <button class="icon-btn" data-act="edit" data-id="${p.id}" title="ÙˆÛŒØ±Ø§ÛŒØ´">âœ</button>
          <button class="icon-btn danger" data-act="del" data-id="${p.id}" title="Ø­Ø°Ù">ğŸ—‘</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  };

  $("#projectFilter").addEventListener("change", renderProjects);
  $("#btnAddProject").addEventListener("click", () => { showView("projects"); openProjectDialog(null); });
  $("#btnAddProject2").addEventListener("click", () => openProjectDialog(null));

  $("#projectTbody").addEventListener("click", (e) => {
    const btn = e.target.closest("[data-act]");
    if(!btn) return;
    const id = btn.dataset.id;
    const act = btn.dataset.act;
    const proj = state.projects.find(p => p.id === id);
    if(!proj) return;

    if(act==="edit"){ openProjectDialog(proj); return; }
    if(act==="del"){
      state.projects = state.projects.filter(p => p.id !== id);
      saveState(); renderProjects(); renderDashboard(); renderDashboardCharts();
      toast("Ù¾Ø±ÙˆÚ˜Ù‡ Ø­Ø°Ù Ø´Ø¯.");
    }
  });

  $("#btnProjectSave").addEventListener("click", () => {
    const name = $("#projName").value.trim();
    if(!name){ toast("Ø¹Ù†ÙˆØ§Ù† Ù¾Ø±ÙˆÚ˜Ù‡ Ø¶Ø±ÙˆØ±ÛŒÙ‡."); return; }

    const tags = $("#projTags").value.split(",").map(x=>x.trim()).filter(Boolean);
    const patch = {
      name,
      client: $("#projClient").value.trim(),
      amount: Number($("#projAmount").value || 0),
      date: $("#projDate").value || todayISO(),
      status: $("#projStatus").value,
      tags,
      notes: $("#projNotes").value
    };

    if(editingProjectId){
      const idx = state.projects.findIndex(p => p.id === editingProjectId);
      if(idx >= 0) state.projects[idx] = { ...state.projects[idx], ...patch };
      toast("Ù¾Ø±ÙˆÚ˜Ù‡ Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯ âœ…");
    } else {
      state.projects.unshift({ id: uid(), ...patch });
      toast("Ù¾Ø±ÙˆÚ˜Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ âœ…");
    }

    saveState();
    closeDlg("dlgProject");
    renderAll();
    renderDashboardCharts();
  });

  $("#btnProjectDelete").addEventListener("click", () => {
    if(!editingProjectId) return;
    state.projects = state.projects.filter(p => p.id !== editingProjectId);
    saveState();
    closeDlg("dlgProject");
    renderAll();
    renderDashboardCharts();
    toast("Ù¾Ø±ÙˆÚ˜Ù‡ Ø­Ø°Ù Ø´Ø¯.");
  });

  // =========================
  // Goals
  // =========================
  let editingGoalId = null;

  const goalRate = (g) => {
    const t = Number(g.target||0);
    const c = Number(g.current||0);
    if(!t) return 0;
    return Math.max(0, Math.min(100, Math.round((c/t)*100)));
  };

  const openGoalDialog = (goal=null) => {
    editingGoalId = goal ? goal.id : null;
    $("#dlgGoalTitle").textContent = goal ? "ÙˆÛŒØ±Ø§ÛŒØ´ Ù‡Ø¯Ù" : "Ø§ÙØ²ÙˆØ¯Ù† Ù‡Ø¯Ù";
    $("#btnGoalDelete").style.visibility = goal ? "visible" : "hidden";

    $("#goalTitle").value = goal ? goal.title : "";
    $("#goalHorizon").value = goal ? goal.horizon : "Û³ Ù…Ø§Ù‡";
    $("#goalMetric").value = goal ? goal.metric : "Ø¹Ø§Ø¯Øª";
    $("#goalTarget").value = goal ? Number(goal.target||0) : 100;
    $("#goalCurrent").value = goal ? Number(goal.current||0) : 0;
    $("#goalNotes").value = goal ? (goal.notes||"") : "";
    $("#goalMilestones").value = goal ? (goal.milestones||[]).map(m=>m.text).join("\n") : "";
    openDlg("dlgGoal");
  };

  const renderGoals = () => {
    const list = $("#goalsList");
    list.innerHTML = "";
    $("#goalsEmpty").style.display = state.goals.length ? "none" : "block";

    state.goals.forEach(g => {
      const rate = goalRate(g);
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="row">
          <div>
            <h3 style="margin-bottom:2px">${escapeHtml(g.title)}</h3>
            <div class="muted small">Ø§ÙÙ‚: ${escapeHtml(g.horizon||"â€”")} â€¢ Ù…ØªØ±ÛŒÚ©: ${escapeHtml(g.metric||"â€”")}</div>
          </div>
          <div class="btn-row">
            <button class="btn" data-act="editGoal" data-id="${g.id}">ÙˆÛŒØ±Ø§ÛŒØ´</button>
            <button class="btn danger" data-act="delGoal" data-id="${g.id}">Ø­Ø°Ù</button>
          </div>
        </div>

        <div style="margin-top:10px" class="chips">
          <span class="chip acc">ÙØ¹Ù„ÛŒ: <b>${moneyFA(g.current)}</b></span>
          <span class="chip">Ù‡Ø¯Ù: <b>${moneyFA(g.target)}</b></span>
          <span class="chip ok">Ù¾ÛŒØ´Ø±ÙØª: <b>${rate}%</b></span>
        </div>

        <div style="margin-top:10px" class="bar"><i style="width:${rate}%"></i></div>

        <div class="sep"></div>
        <div class="row" style="gap:10px;align-items:stretch">
          <div style="flex:1">
            <label>Ø¢Ù¾Ø¯ÛŒØª Ù…Ù‚Ø¯Ø§Ø± ÙØ¹Ù„ÛŒ</label>
            <input class="input" type="number" value="${Number(g.current||0)}" data-act="curInput" data-id="${g.id}" />
          </div>
          <div style="width: 180px">
            <label>&nbsp;</label>
            <button class="btn primary" data-act="saveCur" data-id="${g.id}">Ø°Ø®ÛŒØ±Ù‡ Ù…Ù‚Ø¯Ø§Ø±</button>
          </div>
        </div>

        <div class="sep"></div>
        <div class="row">
          <h3 style="margin:0">Ù…Ø§ÛŒÙ„Ø³ØªÙˆÙ†â€ŒÙ‡Ø§</h3>
          <span class="muted2 small">${(g.milestones||[]).filter(m=>m.done).length}/${(g.milestones||[]).length}</span>
        </div>

        <div class="list" style="margin-top:10px">
          ${(g.milestones||[]).map(m => `
            <div class="item" style="align-items:center">
              <div class="item-main">
                <div class="item-title" style="${m.done ? "text-decoration:line-through;opacity:.75" : ""}">${escapeHtml(m.text)}</div>
              </div>
              <div class="item-actions">
                <button class="icon-btn" data-act="toggleMs" data-gid="${g.id}" data-mid="${m.id}">${m.done ? "â†º" : "âœ“"}</button>
              </div>
            </div>
          `).join("")}
        </div>

        ${g.notes ? `<div class="sep"></div><div class="muted small" style="line-height:1.9">${escapeHtml(g.notes)}</div>` : ""}
      `;
      list.appendChild(card);
    });
  };

  $("#btnAddGoal").addEventListener("click", () => { showView("goals"); openGoalDialog(null); });
  $("#btnAddGoal2").addEventListener("click", () => openGoalDialog(null));

  $("#goalsList").addEventListener("click", (e) => {
    const btn = e.target.closest("[data-act]");
    if(!btn) return;
    const act = btn.dataset.act;

    if(act==="editGoal"){
      const goal = state.goals.find(g => g.id === btn.dataset.id);
      if(goal) openGoalDialog(goal);
      return;
    }
    if(act==="delGoal"){
      const id = btn.dataset.id;
      state.goals = state.goals.filter(g => g.id !== id);
      saveState(); renderGoals(); toast("Ù‡Ø¯Ù Ø­Ø°Ù Ø´Ø¯.");
      return;
    }
    if(act==="toggleMs"){
      const gid = btn.dataset.gid;
      const mid = btn.dataset.mid;
      const goal = state.goals.find(g => g.id === gid);
      if(!goal) return;
      const ms = (goal.milestones||[]).find(m => m.id === mid);
      if(!ms) return;
      ms.done = !ms.done;
      saveState(); renderGoals(); toast("Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯.");
      return;
    }
    if(act==="saveCur"){
      const id = btn.dataset.id;
      const goal = state.goals.find(g => g.id === id);
      if(!goal) return;
      const input = $(`[data-act="curInput"][data-id="${id}"]`, $("#goalsList"));
      goal.current = Number(input.value || 0);
      saveState(); renderGoals(); toast("Ù…Ù‚Ø¯Ø§Ø± Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ âœ…");
      return;
    }
  });

  $("#btnGoalSave").addEventListener("click", () => {
    const title = $("#goalTitle").value.trim();
    if(!title){ toast("Ø¹Ù†ÙˆØ§Ù† Ù‡Ø¯Ù Ø¶Ø±ÙˆØ±ÛŒÙ‡."); return; }

    const milestones = $("#goalMilestones").value
      .split("\n").map(x=>x.trim()).filter(Boolean)
      .map(text => ({ id: uid(), text, done:false }));

    const patch = {
      title,
      horizon: $("#goalHorizon").value.trim() || "â€”",
      metric: $("#goalMetric").value.trim() || "â€”",
      target: Number($("#goalTarget").value || 0),
      current: Number($("#goalCurrent").value || 0),
      notes: $("#goalNotes").value,
      milestones
    };

    if(editingGoalId){
      const idx = state.goals.findIndex(g => g.id === editingGoalId);
      if(idx >= 0){
        const prev = state.goals[idx];
        const prevMap = new Map((prev.milestones||[]).map(m => [m.text, m.done]));
        patch.milestones = patch.milestones.map(m => ({...m, done: !!prevMap.get(m.text)}));
        state.goals[idx] = { ...prev, ...patch };
      }
      toast("Ù‡Ø¯Ù Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯ âœ…");
    } else {
      state.goals.unshift({ id: uid(), ...patch });
      toast("Ù‡Ø¯Ù Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ âœ…");
    }

    saveState();
    closeDlg("dlgGoal");
    renderAll();
  });

  $("#btnGoalDelete").addEventListener("click", () => {
    if(!editingGoalId) return;
    state.goals = state.goals.filter(g => g.id !== editingGoalId);
    saveState();
    closeDlg("dlgGoal");
    renderAll();
    toast("Ù‡Ø¯Ù Ø­Ø°Ù Ø´Ø¯.");
  });

  // =========================
  // Finance / Holdings
  // =========================
  let editingHoldingId = null;

  const openHoldingDialog = (h=null) => {
    editingHoldingId = h ? h.id : null;
    $("#dlgHoldingTitle").textContent = h ? "ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ø§Ø±Ø§ÛŒÛŒ" : "Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø§Ø±Ø§ÛŒÛŒ";
    $("#btnHoldingDelete").style.visibility = h ? "visible" : "hidden";

    $("#holdType").value = h ? h.type : "Ø·Ù„Ø§";
    $("#holdUnit").value = h ? h.unit : "ØªÙˆÙ…Ø§Ù†";
    $("#holdAmount").value = h ? Number(h.amount||0) : "";

    openDlg("dlgHolding");
  };

  const renderHoldings = () => {
    const tbody = $("#holdingsTbody");
    tbody.innerHTML = "";
    $("#holdingsEmpty").style.display = state.assets.holdings.length ? "none" : "block";

    state.assets.holdings.forEach(h => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><b>${escapeHtml(h.type)}</b></td>
        <td>${moneyFA(h.amount)}</td>
        <td>${escapeHtml(h.unit)}</td>
        <td class="nowrap">
          <button class="icon-btn" data-act="editHold" data-id="${h.id}">âœ</button>
          <button class="icon-btn danger" data-act="delHold" data-id="${h.id}">ğŸ—‘</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  };

  const renderFinancePlan = () => {
    $("#monthlyMinIncome").value = Number(state.profile.monthlyMinIncome||0);
    $("#savingsRateTarget").value = Number(state.profile.savingsRateTarget||0);

    const split = state.assets.plan.split;
    $("#splitGold").value = Number(split.gold||0);
    $("#splitCrypto").value = Number(split.crypto||0);
    $("#splitSilver").value = Number(split.silver||0);
    $("#splitCash").value = Number(split.cash||0);

    const sum = Number(split.gold||0) + Number(split.crypto||0) + Number(split.silver||0) + Number(split.cash||0);
    $("#splitSum").textContent = sum + "%";
    $("#splitWarn").style.display = (sum === 100) ? "none" : "inline-flex";

    const base = Number(state.profile.monthlyMinIncome||0) * Number(state.profile.savingsRateTarget||0);
    const suggestions = [
      { label: "Ø·Ù„Ø§", pct: split.gold, val: base * (split.gold/100) },
      { label: "Ú©Ø±ÛŒÙ¾ØªÙˆ", pct: split.crypto, val: base * (split.crypto/100) },
      { label: "Ù†Ù‚Ø±Ù‡", pct: split.silver, val: base * (split.silver/100) },
      { label: "Ù†Ù‚Ø¯/ØªØªØ± Ø¢Ø²Ø§Ø¯", pct: split.cash, val: base * (split.cash/100) }
    ];

    const box = $("#financeSuggestions");
    box.innerHTML = "";
    suggestions.forEach(s => {
      const el = document.createElement("span");
      el.className = "chip";
      el.innerHTML = `${s.label}: <b>${moneyFA(Math.round(s.val))}</b> ${state.profile.currency} <span class="muted2">(${s.pct}%)</span>`;
      box.appendChild(el);
    });
  };

  const renderFinance = () => { renderHoldings(); renderFinancePlan(); };

  $("#btnAddHolding").addEventListener("click", () => { showView("finance"); openHoldingDialog(null); });
  $("#btnAddHolding2").addEventListener("click", () => openHoldingDialog(null));

  $("#holdingsTbody").addEventListener("click", (e) => {
    const btn = e.target.closest("[data-act]");
    if(!btn) return;
    const id = btn.dataset.id;
    const act = btn.dataset.act;
    const h = state.assets.holdings.find(x => x.id === id);
    if(!h) return;

    if(act==="editHold"){ openHoldingDialog(h); return; }
    if(act==="delHold"){
      state.assets.holdings = state.assets.holdings.filter(x => x.id !== id);
      saveState(); renderFinance(); renderDashboard(); renderDashboardCharts();
      toast("Ø¯Ø§Ø±Ø§ÛŒÛŒ Ø­Ø°Ù Ø´Ø¯.");
    }
  });

  $("#btnHoldingSave").addEventListener("click", () => {
    const type = $("#holdType").value.trim();
    const unit = $("#holdUnit").value.trim();
    const amount = Number($("#holdAmount").value || 0);
    if(!type || !unit){ toast("Ù†ÙˆØ¹ Ùˆ ÙˆØ§Ø­Ø¯ Ø¶Ø±ÙˆØ±ÛŒÙ‡."); return; }

    const patch = { type, unit, amount };

    if(editingHoldingId){
      const idx = state.assets.holdings.findIndex(x => x.id === editingHoldingId);
      if(idx >= 0) state.assets.holdings[idx] = { ...state.assets.holdings[idx], ...patch };
      toast("Ø¯Ø§Ø±Ø§ÛŒÛŒ Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯ âœ…");
    } else {
      state.assets.holdings.unshift({ id: uid(), ...patch });
      toast("Ø¯Ø§Ø±Ø§ÛŒÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ âœ…");
    }

    saveState();
    closeDlg("dlgHolding");
    renderFinance();
    renderDashboard();
    renderDashboardCharts();
  });

  $("#btnHoldingDelete").addEventListener("click", () => {
    if(!editingHoldingId) return;
    state.assets.holdings = state.assets.holdings.filter(x => x.id !== editingHoldingId);
    saveState();
    closeDlg("dlgHolding");
    renderFinance();
    renderDashboard();
    renderDashboardCharts();
    toast("Ø¯Ø§Ø±Ø§ÛŒÛŒ Ø­Ø°Ù Ø´Ø¯.");
  });

  $("#monthlyMinIncome").addEventListener("input", (e) => { state.profile.monthlyMinIncome = Number(e.target.value || 0); saveState(); renderFinancePlan(); renderDashboard(); });
  $("#savingsRateTarget").addEventListener("input", (e) => { state.profile.savingsRateTarget = Number(e.target.value || 0); saveState(); renderFinancePlan(); renderDashboard(); });

  const bindSplit = (id, key) => {
    $(id).addEventListener("input", (e) => {
      state.assets.plan.split[key] = Number(e.target.value || 0);
      saveState(); renderFinancePlan(); renderDashboard();
    });
  };
  bindSplit("#splitGold","gold");
  bindSplit("#splitCrypto","crypto");
  bindSplit("#splitSilver","silver");
  bindSplit("#splitCash","cash");

  $("#btnNormalizeSplit").addEventListener("click", () => {
    const s = state.assets.plan.split;
    const sum = Number(s.gold||0)+Number(s.crypto||0)+Number(s.silver||0)+Number(s.cash||0);
    if(sum <= 0){ toast("Ø§ÙˆÙ„ Ø¯Ø±ØµØ¯Ù‡Ø§ Ø±Ùˆ ÙˆØ§Ø±Ø¯ Ú©Ù†."); return; }
    s.gold = Math.round((s.gold/sum)*100);
    s.crypto = Math.round((s.crypto/sum)*100);
    s.silver = Math.round((s.silver/sum)*100);
    s.cash = 100 - (s.gold + s.crypto + s.silver);
    saveState(); renderFinancePlan(); toast("Ù†Ø±Ù…Ø§Ù„ Ø´Ø¯ âœ…");
  });

  // =========================
  // Notes
  // =========================
  const renderNotes = () => {
    $("#noteDaily").value = state.notes.daily || "";
    $("#noteMotivation").value = state.notes.motivation || "";
    $("#noteJournal").value = state.notes.journal || "";
    $("#noteIdeas").value = state.notes.ideas || "";
  };

  const bindNote = (id, key) => {
    $(id).addEventListener("input", (e) => {
      state.notes[key] = e.target.value;
      saveState();
      if(key === "motivation") $("#dashMotivation").textContent = state.notes.motivation || "â€”";
    });
  };
  bindNote("#noteDaily","daily");
  bindNote("#noteMotivation","motivation");
  bindNote("#noteJournal","journal");
  bindNote("#noteIdeas","ideas");

  $("#btnGoNotes").addEventListener("click", () => showView("notes"));

  // =========================
  // Theme / Export / Import / Reset
  // =========================
  $("#btnTheme").addEventListener("click", () => {
    const next = (state.settings.theme === "dark") ? "light" : "dark";
    state.settings.theme = next;
    saveState();
    renderHeader();
    renderDashboardCharts();
    toast("ØªÙ… ØªØºÛŒÛŒØ± Ú©Ø±Ø¯");
  });

  $("#btnExport").addEventListener("click", () => {
    const blob = new Blob([JSON.stringify(state, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "ArminOS-backup.json";
    a.click();
    URL.revokeObjectURL(url);
    toast("Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯ âœ…");
  });

  $("#btnImport").addEventListener("click", () => {
    $("#importFile").value = "";
    openDlg("dlgImport");
  });

  $("#btnImportDo").addEventListener("click", async () => {
    const file = $("#importFile").files && $("#importFile").files[0];
    if(!file){ toast("ÙØ§ÛŒÙ„ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡."); return; }
    const text = await file.text();
    const data = safeParse(text);
    if(!data || !data.meta){ toast("ÙØ§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª."); return; }
    state = data;
    saveState();
    closeDlg("dlgImport");
    renderAll();
    renderDashboardCharts();
    toast("Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ÙˆØ§Ø±Ø¯ Ø´Ø¯ âœ…");
  });

  $("#btnReset").addEventListener("click", () => {
    const ok = confirm("Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„ØŸ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. Ù‚Ø¨Ù„Ø´ Export Ø¨Ú¯ÛŒØ±.");
    if(!ok) return;
    state = defaultState();
    saveState();
    monthCursor = currentJalaliYM();
    plannerDate = todayISO();
    renderAll();
    renderDashboardCharts();
    toast("Ø±ÛŒØ³Øª Ø´Ø¯.");
  });

  // =========================
  // Utilities
  // =========================
  function escapeHtml(str){
    return String(str ?? "")
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll("\"","&quot;").replaceAll("'","&#039;");
  }

  // =========================
  // Render All
  // =========================
  const renderAll = () => {
    renderHeader();
    renderDashboard();
    renderPlanner();
    renderCalendar();
    renderProjects();
    renderGoals();
    renderFinance();
    renderNotes();
  };

  // Init
  initLock();
  renderAll();
  renderDashboardCharts();
})();
</script>
</body>
</html>
